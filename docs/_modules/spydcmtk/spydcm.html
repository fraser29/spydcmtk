

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>spydcmtk.spydcm &mdash; spydcmtk 1.1.5 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=a48ae3df"></script>
      <script src="../../_static/doctools.js?v=888ff710"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            spydcmtk
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../usage/introduction.html">spydcmtk</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage/quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage/version-history.html">Version</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage/dicom-conversion.html">DICOM CONVERSION</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">spydcmtk</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">spydcmtk</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">spydcmtk.spydcm</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for spydcmtk.spydcm</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&quot;&quot;&quot;Module that exposes the routines and utilities making up SPYDCMTK</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">base64</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">pydicom</span> <span class="k">as</span> <span class="nn">dicom</span>

<span class="c1"># Local imports </span>
<span class="kn">import</span> <span class="nn">spydcmtk.dcmTools</span> <span class="k">as</span> <span class="nn">dcmTools</span>
<span class="kn">import</span> <span class="nn">spydcmtk.dcmTK</span> <span class="k">as</span> <span class="nn">dcmTK</span>
<span class="kn">from</span> <span class="nn">spydcmtk.spydcm_config</span> <span class="kn">import</span> <span class="n">SpydcmTK_config</span>


<div class="viewcode-block" id="INTERACTIVE">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.spydcm.INTERACTIVE">[docs]</a>
<span class="k">class</span> <span class="nc">INTERACTIVE</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">study</span><span class="p">,</span> <span class="n">outputPath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">study</span> <span class="o">=</span> <span class="n">study</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outputPath</span> <span class="o">=</span> <span class="n">outputPath</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;1&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;Data summary&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataSummary</span><span class="p">),</span>
            <span class="s1">&#39;2&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;Build VTS&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">buildVTS</span><span class="p">),</span>
            <span class="s1">&#39;3&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;Build FDQ&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">buildFDQ</span><span class="p">),</span>
            <span class="s1">&#39;4&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;Build overview image&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">buildOverviewImage</span><span class="p">),</span>
            <span class="s1">&#39;q&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;Quit&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">quit</span><span class="p">)</span>
        <span class="p">}</span>

<div class="viewcode-block" id="INTERACTIVE.displayMenu">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.spydcm.INTERACTIVE.displayMenu">[docs]</a>
    <span class="k">def</span> <span class="nf">displayMenu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Select an option:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="p">(</span><span class="n">description</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">description</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="INTERACTIVE.getUserInput">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.spydcm.INTERACTIVE.getUserInput">[docs]</a>
    <span class="k">def</span> <span class="nf">getUserInput</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">question</span><span class="o">=</span><span class="s2">&quot;your choice&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">input</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Enter </span><span class="si">{</span><span class="n">question</span><span class="si">}</span><span class="s2">: &quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="INTERACTIVE.run">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.spydcm.INTERACTIVE.run">[docs]</a>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">displayMenu</span><span class="p">()</span>
            <span class="n">choice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getUserInput</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">choice</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">choice</span><span class="p">][</span><span class="mi">1</span><span class="p">]()</span>  <span class="c1"># Execute the corresponding function</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Invalid option. Please try again.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="INTERACTIVE.dataSummary">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.spydcm.INTERACTIVE.dataSummary">[docs]</a>
    <span class="k">def</span> <span class="nf">dataSummary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">study</span><span class="o">.</span><span class="n">getStudySummary</span><span class="p">())</span></div>


<div class="viewcode-block" id="INTERACTIVE.buildVTS">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.spydcm.INTERACTIVE.buildVTS">[docs]</a>
    <span class="k">def</span> <span class="nf">buildVTS</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataSummary</span><span class="p">()</span>
        <span class="n">seNum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getUserInput</span><span class="p">(</span><span class="s2">&quot;series number&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span> 
            <span class="n">seNum</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">seNum</span><span class="p">)</span>
            <span class="n">dcmSeries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">study</span><span class="o">.</span><span class="n">getSeriesByID</span><span class="p">(</span><span class="n">seNum</span><span class="p">)</span>
            <span class="n">outputFilename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getUserInput</span><span class="p">(</span><span class="s2">&quot;file name (vts)&quot;</span><span class="p">)</span>
            <span class="n">outputpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputPath</span><span class="p">,</span> <span class="n">outputFilename</span><span class="p">)</span>
            <span class="n">dcmSeries</span><span class="o">.</span><span class="n">writeToVTS</span><span class="p">(</span><span class="n">outputpath</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Invalid option. Please try again&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="INTERACTIVE.buildFDQ">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.spydcm.INTERACTIVE.buildFDQ">[docs]</a>
    <span class="k">def</span> <span class="nf">buildFDQ</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataSummary</span><span class="p">()</span>
        <span class="n">seNum_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getUserInput</span><span class="p">(</span><span class="s2">&quot;series numbers for FDQ&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span> 
            <span class="n">seNum_4</span> <span class="o">=</span> <span class="n">seNum_</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="n">seNum_4</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">seNum_4</span><span class="p">]</span>
            <span class="n">outputFilename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getUserInput</span><span class="p">(</span><span class="s2">&quot;file name (pvd)&quot;</span><span class="p">)</span>
            <span class="n">outputpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputPath</span><span class="p">,</span> <span class="n">outputFilename</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">study</span><span class="o">.</span><span class="n">writeFDQ</span><span class="p">(</span><span class="n">seNum_4</span><span class="p">,</span> <span class="n">outputpath</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Invalid option. Please try again&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="INTERACTIVE.buildOverviewImage">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.spydcm.INTERACTIVE.buildOverviewImage">[docs]</a>
    <span class="k">def</span> <span class="nf">buildOverviewImage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataSummary</span><span class="p">()</span>
        <span class="n">seNum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getUserInput</span><span class="p">(</span><span class="s2">&quot;series number&quot;</span><span class="p">)</span>
        <span class="n">outputFilename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getUserInput</span><span class="p">(</span><span class="s2">&quot;file name (png) - leave blank to show&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">outputFilename</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">outputpath</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">outputpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputPath</span><span class="p">,</span> <span class="n">outputFilename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">study</span><span class="o">.</span><span class="n">getSeriesByID</span><span class="p">(</span><span class="n">seNum</span><span class="p">)</span><span class="o">.</span><span class="n">buildOverviewImage</span><span class="p">(</span><span class="n">outputpath</span><span class="p">)</span></div>


<div class="viewcode-block" id="INTERACTIVE.quit">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.spydcm.INTERACTIVE.quit">[docs]</a>
    <span class="k">def</span> <span class="nf">quit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Exiting the menu.&quot;</span><span class="p">)</span>
        <span class="n">exit</span><span class="p">()</span>  </div>
</div>



<div class="viewcode-block" id="writeDirectoryToNII">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.spydcm.writeDirectoryToNII">[docs]</a>
<span class="k">def</span> <span class="nf">writeDirectoryToNII</span><span class="p">(</span><span class="n">dcmDir</span><span class="p">,</span> <span class="n">outputPath</span><span class="p">,</span> <span class="n">fileName</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Write a directory of dicom files to a Nifti (`*.nii.gz`) file. </span>
<span class="sd">        Uses dcm2nii so MUST have dcm2nii installed and within path.</span>

<span class="sd">    Args:</span>
<span class="sd">        dcmDir (str): Path to directory containing dicom files</span>
<span class="sd">        outputPath (str): Path to output directory where to save nifti</span>
<span class="sd">        fileName (str): Name of output nii.gz file (will rename nii.gz output from dcm2nii)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">dcmTools</span><span class="o">.</span><span class="n">writeDirectoryToNII</span><span class="p">(</span><span class="n">dcmDir</span><span class="p">,</span> <span class="n">outputPath</span><span class="p">,</span> <span class="n">fileName</span><span class="p">)</span></div>



<div class="viewcode-block" id="buildTableOfDicomParamsForManuscript">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.spydcm.buildTableOfDicomParamsForManuscript">[docs]</a>
<span class="k">def</span> <span class="nf">buildTableOfDicomParamsForManuscript</span><span class="p">(</span><span class="n">topLevelDirectoryList</span><span class="p">,</span> <span class="n">outputCSVPath</span><span class="p">,</span> <span class="n">seriesDescriptionIdentifier</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ONE_FILE_PER_DIR</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Build a simple table of dicom parameters that would be suitable for input into a scientific manuscript.</span>
<span class="sd">        Output is comma delimited multiline string of Tr, Te (etc) stats. </span>

<span class="sd">    Args:</span>
<span class="sd">        topLevelDirectoryList (list): list of str that are paths to directories containing dicom files</span>
<span class="sd">        outputCSVPath (str): path to outputCSV</span>
<span class="sd">        seriesDescriptionIdentifier (str, optional): A substring of SeriesDescription tag used to select certian series only. Defaults to None.</span>
<span class="sd">        ONE_FILE_PER_DIR (bool, optional): Set false to read all dicoms, can set True for faster reading if dicoms organised. Default: True</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dfData</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">inspectDir</span> <span class="ow">in</span> <span class="n">topLevelDirectoryList</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ssL</span> <span class="o">=</span> <span class="n">dcmTK</span><span class="o">.</span><span class="n">ListOfDicomStudies</span><span class="o">.</span><span class="n">setFromDirectory</span><span class="p">(</span><span class="n">inspectDir</span><span class="p">,</span> <span class="n">OVERVIEW</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">HIDE_PROGRESSBAR</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ONE_FILE_PER_DIR</span><span class="o">=</span><span class="n">ONE_FILE_PER_DIR</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span> <span class="c1"># no dicoms found </span>
            <span class="k">continue</span>
        <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="n">ssL</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">seriesDescriptionIdentifier</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">matchingSeries</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">getSeriesMatchingDescription</span><span class="p">([</span><span class="n">seriesDescriptionIdentifier</span><span class="p">],</span> <span class="n">RETURN_SERIES_OBJ</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">matchingSeries</span> <span class="o">=</span> <span class="n">ss</span>
            <span class="k">if</span> <span class="n">matchingSeries</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">iSeries</span> <span class="ow">in</span> <span class="n">matchingSeries</span><span class="p">:</span>
                    <span class="n">resDict</span> <span class="o">=</span> <span class="n">iSeries</span><span class="o">.</span><span class="n">getSeriesInfoDict</span><span class="p">(</span><span class="n">EXTRA_TAGS</span><span class="o">=</span><span class="n">SpydcmTK_config</span><span class="o">.</span><span class="n">MANUSCRIPT_TABLE_EXTRA_TAG_LIST</span><span class="p">)</span>
                    <span class="n">resDict</span><span class="p">[</span><span class="s2">&quot;Identifier&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dcmTools</span><span class="o">.</span><span class="n">getDicomFileIdentifierStr</span><span class="p">(</span><span class="n">iSeries</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">dfData</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">resDict</span><span class="p">)</span>
    <span class="n">stats</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">dfData</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">dfData</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="p">[</span><span class="s2">&quot;Identifier&quot;</span><span class="p">])</span>
    <span class="n">tagList</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">dfData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">strOut</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">+</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tagList</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">dfData</span><span class="p">:</span>
        <span class="n">strOut</span> <span class="o">+=</span> <span class="s1">&#39;,&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tagList</span><span class="p">:</span>
            <span class="n">strOut</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">,&#39;</span>
            <span class="n">stats</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">strOut</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">strOut</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">STATS:</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">myFunc</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;Mean&#39;</span><span class="p">,</span> <span class="s1">&#39;Standard Deviation&#39;</span><span class="p">,</span> <span class="s1">&#39;Median&#39;</span><span class="p">,</span> <span class="s1">&#39;Min&#39;</span><span class="p">,</span> <span class="s1">&#39;Max&#39;</span><span class="p">],</span> 
                             <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">k1</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tagList</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">k1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">strOut</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s1">,&#39;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">strOut</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">myFunc</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="n">tagList</span><span class="p">[</span><span class="n">k1</span><span class="p">]])</span><span class="si">}</span><span class="s1">,&#39;</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">strOut</span> <span class="o">+=</span> <span class="s1">&#39;NAN,&#39;</span>
        <span class="n">strOut</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outputCSVPath</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fid</span><span class="p">:</span>
        <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">strOut</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">outputCSVPath</span></div>



<div class="viewcode-block" id="getAllDirsUnderRootWithDicoms">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.spydcm.getAllDirsUnderRootWithDicoms">[docs]</a>
<span class="k">def</span> <span class="nf">getAllDirsUnderRootWithDicoms</span><span class="p">(</span><span class="n">rootDir</span><span class="p">,</span> <span class="n">QUIET</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">FORCE_READ</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">fullDirsWithDicoms</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">rootDir</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">iFile</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="n">thisFile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">iFile</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">dicom</span><span class="o">.</span><span class="n">dcmread</span><span class="p">(</span><span class="n">thisFile</span><span class="p">,</span> <span class="n">stop_before_pixels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">defer_size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="n">FORCE_READ</span><span class="p">)</span> <span class="c1"># will error if not dicom</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">QUIET</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;OK: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">thisFile</span><span class="p">))</span>
                <span class="n">fullDirsWithDicoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
                <span class="k">break</span>
            <span class="k">except</span> <span class="n">dicom</span><span class="o">.</span><span class="n">filereader</span><span class="o">.</span><span class="n">InvalidDicomError</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">QUIET</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;FAIL: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">thisFile</span><span class="p">))</span>
                <span class="k">continue</span>
    <span class="k">return</span> <span class="n">fullDirsWithDicoms</span></div>



<div class="viewcode-block" id="anonymiseInPlace">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.spydcm.anonymiseInPlace">[docs]</a>
<span class="k">def</span> <span class="nf">anonymiseInPlace</span><span class="p">(</span><span class="n">dicomDirectory</span><span class="p">,</span> <span class="n">anonName</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">anonID</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">QUIET</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">anonName</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">returnFirstDicomFound</span><span class="p">(</span><span class="n">dicomDirectory</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="c1"># Nothing to anonymise... </span>
        <span class="n">anonName</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="c1">#</span>
    <span class="n">tmpDir</span> <span class="o">=</span> <span class="n">dicomDirectory</span><span class="o">+</span><span class="s2">&quot;.TEMP.WORKING&quot;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">dicomDirectory</span><span class="p">,</span> <span class="n">tmpDir</span><span class="p">)</span>
    <span class="n">dcmTools</span><span class="o">.</span><span class="n">streamDicoms</span><span class="p">(</span><span class="n">tmpDir</span><span class="p">,</span> <span class="n">dicomDirectory</span><span class="p">,</span> <span class="n">anonName</span><span class="o">=</span><span class="n">anonName</span><span class="p">,</span> <span class="n">anonID</span><span class="o">=</span><span class="n">anonID</span><span class="p">,</span> <span class="n">HIDE_PROGRESSBAR</span><span class="o">=</span><span class="n">QUIET</span><span class="p">)</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">tmpDir</span><span class="p">)</span></div>



<div class="viewcode-block" id="returnFirstDicomFound">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.spydcm.returnFirstDicomFound">[docs]</a>
<span class="k">def</span> <span class="nf">returnFirstDicomFound</span><span class="p">(</span><span class="n">rootDir</span><span class="p">,</span> <span class="n">FILE_NAME_ONLY</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">MatchingTag_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Search recursively for first dicom file under root and return.</span>
<span class="sd">    If have dicoms in nice folder structure then this can be a fast way to find, e.g. all series with protocol X</span>

<span class="sd">    :param rootDir: directory on filesystem</span>
<span class="sd">    :param FILE_NAME_ONLY: If true will return the file name [Default False]</span>
<span class="sd">    :param MatchingTag_dict: If given then will only consider dicoms where tag(key) matches value given [Default None]</span>
<span class="sd">    :return: pydicom dataset&lt;without pixel data&gt; or fileName&lt;str&gt;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">rootDir</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">iFile</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;dicomdir&#39;</span> <span class="ow">in</span> <span class="n">iFile</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="k">continue</span>
            <span class="n">thisFile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">iFile</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">dataset</span> <span class="o">=</span> <span class="n">dicom</span><span class="o">.</span><span class="n">dcmread</span><span class="p">(</span><span class="n">thisFile</span><span class="p">,</span> <span class="n">stop_before_pixels</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">MatchingTag_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">tf</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">iKey</span> <span class="ow">in</span> <span class="n">MatchingTag_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">tf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">dataset</span><span class="p">[</span><span class="n">iKey</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">MatchingTag_dict</span><span class="p">[</span><span class="n">iKey</span><span class="p">]))</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">tf</span><span class="p">):</span>
                        <span class="k">continue</span>
                <span class="k">if</span> <span class="n">FILE_NAME_ONLY</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">thisFile</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">dataset</span>
            <span class="k">except</span> <span class="n">dicom</span><span class="o">.</span><span class="n">filereader</span><span class="o">.</span><span class="n">InvalidDicomError</span><span class="p">:</span>
                <span class="k">continue</span>
    <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="getTag">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.spydcm.getTag">[docs]</a>
<span class="k">def</span> <span class="nf">getTag</span><span class="p">(</span><span class="n">pathToDicoms</span><span class="p">,</span> <span class="n">tagName</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convienience function to find first dicom and then get tag value</span>

<span class="sd">    Args:</span>
<span class="sd">        pathToDicoms (str): path to dicoms</span>
<span class="sd">        tagName (str): dicom tag name</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">returnFirstDicomFound</span><span class="p">(</span><span class="n">pathToDicoms</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ds</span><span class="p">[</span><span class="n">tagName</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">filename</span></div>


<div class="viewcode-block" id="directoryToVTI">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.spydcm.directoryToVTI">[docs]</a>
<span class="k">def</span> <span class="nf">directoryToVTI</span><span class="p">(</span><span class="n">dcmDirectory</span><span class="p">,</span> <span class="n">outputFolder</span><span class="p">,</span> 
                   <span class="n">outputNamingTags</span><span class="o">=</span><span class="n">SpydcmTK_config</span><span class="o">.</span><span class="n">VTI_NAMING_TAG_LIST</span><span class="p">,</span> 
                   <span class="n">QUITE</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">FORCE</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">TRUE_ORIENTATION</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert directory of dicoms to VTI files (one vti per series)</span>
<span class="sd">        Naming built from dicom tags: </span>

<span class="sd">    Args:</span>
<span class="sd">        dcmDirectory (str): Directory containing dicom files</span>
<span class="sd">        outputFolder (str): Directory where vti output files to be written</span>
<span class="sd">        outputNamingTags (tuple, optional): Dicom tags used to generate vti file name. </span>
<span class="sd">                        Defaults to (&#39;PatientName&#39;, &#39;SeriesNumber&#39;, &#39;SeriesDescription&#39;)</span>
<span class="sd">        QUITE (bool, optional): Suppress output information. Defaults to True.</span>
<span class="sd">        FORCE (bool, optional): Set True to overwrite already present files. Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: List of output file names written</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ListDicomStudies</span> <span class="o">=</span> <span class="n">dcmTK</span><span class="o">.</span><span class="n">ListOfDicomStudies</span><span class="o">.</span><span class="n">setFromInput</span><span class="p">(</span><span class="n">dcmDirectory</span><span class="p">,</span> <span class="n">HIDE_PROGRESSBAR</span><span class="o">=</span><span class="n">QUITE</span><span class="p">,</span> <span class="n">FORCE_READ</span><span class="o">=</span><span class="n">FORCE</span><span class="p">,</span> <span class="n">OVERVIEW</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> 
    <span class="k">return</span> <span class="n">_listDicomStudiesToVTI</span><span class="p">(</span><span class="n">ListDicomStudies</span><span class="p">,</span> <span class="n">outputFolder</span><span class="o">=</span><span class="n">outputFolder</span><span class="p">,</span> <span class="n">outputNamingTags</span><span class="o">=</span><span class="n">outputNamingTags</span><span class="p">,</span> <span class="n">TRUE_ORIENTATION</span><span class="o">=</span><span class="n">TRUE_ORIENTATION</span><span class="p">)</span></div>



<div class="viewcode-block" id="directoryToVTS">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.spydcm.directoryToVTS">[docs]</a>
<span class="k">def</span> <span class="nf">directoryToVTS</span><span class="p">(</span><span class="n">dcmDirectory</span><span class="p">,</span> <span class="n">outputFolder</span><span class="p">,</span>
                   <span class="n">outputNamingTags</span><span class="o">=</span><span class="n">SpydcmTK_config</span><span class="o">.</span><span class="n">VTI_NAMING_TAG_LIST</span><span class="p">,</span> 
                   <span class="n">QUITE</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">FORCE</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert directory of dicoms to VTS files (Good for cine etc)</span>
<span class="sd">        Naming built from dicom tags: </span>

<span class="sd">    Args:</span>
<span class="sd">        dcmDirectory (str): Directory containing dicom files</span>
<span class="sd">        outputFolder (str): Directory where vti output files to be written</span>
<span class="sd">        outputNamingTags (tuple, optional): Dicom tags used to generate vti file name. </span>
<span class="sd">                        Defaults to (&#39;PatientName&#39;, &#39;SeriesNumber&#39;, &#39;SeriesDescription&#39;)</span>
<span class="sd">        QUITE (bool, optional): Suppress output information. Defaults to True.</span>
<span class="sd">        FORCE (bool, optional): Set True to overwrite already present files. Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: List of output file names written</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ListDicomStudies</span> <span class="o">=</span> <span class="n">dcmTK</span><span class="o">.</span><span class="n">ListOfDicomStudies</span><span class="o">.</span><span class="n">setFromInput</span><span class="p">(</span><span class="n">dcmDirectory</span><span class="p">,</span> <span class="n">HIDE_PROGRESSBAR</span><span class="o">=</span><span class="n">QUITE</span><span class="p">,</span> <span class="n">FORCE_READ</span><span class="o">=</span><span class="n">FORCE</span><span class="p">,</span> <span class="n">OVERVIEW</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> 
    <span class="k">return</span> <span class="n">_listDicomStudiesToVTI</span><span class="p">(</span><span class="n">ListDicomStudies</span><span class="p">,</span> <span class="n">outputFolder</span><span class="o">=</span><span class="n">outputFolder</span><span class="p">,</span> <span class="n">outputNamingTags</span><span class="o">=</span><span class="n">outputNamingTags</span><span class="p">,</span> <span class="n">VTS</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>



<span class="k">def</span> <span class="nf">_listDicomStudiesToVTI</span><span class="p">(</span><span class="n">ListDicomStudies</span><span class="p">,</span> <span class="n">outputFolder</span><span class="p">,</span> <span class="n">outputNamingTags</span><span class="o">=</span><span class="n">SpydcmTK_config</span><span class="o">.</span><span class="n">VTI_NAMING_TAG_LIST</span><span class="p">,</span> <span class="n">QUIET</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">TRUE_ORIENTATION</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">VTS</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">outputFiles</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">iDS</span> <span class="ow">in</span> <span class="n">ListDicomStudies</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">iSeries</span> <span class="ow">in</span> <span class="n">iDS</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">VTS</span><span class="p">:</span>
                <span class="c1"># print(f&quot;DICOMS TO VTS IS NOT IMPLEMENTED YET&quot;)</span>
                <span class="n">fOut</span> <span class="o">=</span> <span class="n">iSeries</span><span class="o">.</span><span class="n">writeToVTS</span><span class="p">(</span><span class="n">outputPath</span><span class="o">=</span><span class="n">outputFolder</span><span class="p">,</span> <span class="n">outputNamingTags</span><span class="o">=</span><span class="n">outputNamingTags</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fOut</span> <span class="o">=</span> <span class="n">iSeries</span><span class="o">.</span><span class="n">writeToVTI</span><span class="p">(</span><span class="n">outputPath</span><span class="o">=</span><span class="n">outputFolder</span><span class="p">,</span> <span class="n">outputNamingTags</span><span class="o">=</span><span class="n">outputNamingTags</span><span class="p">,</span> <span class="n">TRUE_ORIENTATION</span><span class="o">=</span><span class="n">TRUE_ORIENTATION</span><span class="p">)</span>
            <span class="n">outputFiles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fOut</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">QUIET</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Written </span><span class="si">{</span><span class="n">fOut</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">outputFiles</span>

<span class="c1"># =========================================================================</span>
<span class="c1"># =========================================================================</span>
<span class="c1">## DATA TO HTML</span>
<span class="c1"># =========================================================================</span>
<div class="viewcode-block" id="convertInputsToHTML">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.spydcm.convertInputsToHTML">[docs]</a>
<span class="k">def</span> <span class="nf">convertInputsToHTML</span><span class="p">(</span><span class="n">listOfFilePaths</span><span class="p">,</span> <span class="n">outputFile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">glanceHtml</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">QUIET</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">DEBUG</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert inputs to HTML viewable via ParaViewGlance (3D volumes and/or surface polymeshes)</span>
<span class="sd">    </span>
<span class="sd">    Keyword arguments:</span>
<span class="sd">    listOfFilePaths             -- May be nii, vtk or dicoms</span>
<span class="sd">    outputFile (optional)       -- Full path to outputfile, if not given then use first input path. Defaults to None.</span>
<span class="sd">    glanceHtml (optional)       -- Full path to glanceHtml template file, if not given then use default. Defaults to None.</span>
<span class="sd">    QUIET (optional)            -- Set True to suppress output. Defaults to False.</span>
<span class="sd">    DEBUG (optional)            -- Set True to prevent cleanup of intermediary files. Defaults to False.</span>
<span class="sd">    Return: path to html file written</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">CLEAN_UP_LIST</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">FILE_TO_VTK_LIST</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1">## --- Check inputs ---</span>
    <span class="c1"># Glance html</span>
    <span class="k">if</span> <span class="n">glanceHtml</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">thisDir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">glanceHtml</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">thisDir</span><span class="p">,</span> <span class="s1">&#39;ParaViewGlance.html&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">QUIET</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Using ParaView glance file: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">glanceHtml</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">glanceHtml</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> does not exist&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">glanceHtml</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">listOfFilePaths</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span><span class="p">:</span>
        <span class="n">listOfFilePaths</span> <span class="o">=</span> <span class="p">[</span><span class="n">listOfFilePaths</span><span class="p">]</span>
    <span class="c1">## --- Output file ---</span>
    <span class="k">if</span> <span class="n">outputFile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">outputDir</span><span class="p">,</span> <span class="n">fName</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">listOfFilePaths</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">fNameOut</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fName</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;.html&#39;</span>
        <span class="n">outputFile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outputDir</span><span class="p">,</span> <span class="n">fNameOut</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">outputFile</span><span class="p">):</span>
        <span class="n">outputDir</span> <span class="o">=</span> <span class="n">outputFile</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">fName</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">listOfFilePaths</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">fNameOut</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fName</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;.html&#39;</span>
        <span class="n">outputFile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outputDir</span><span class="p">,</span> <span class="n">fNameOut</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">outputDir</span><span class="p">,</span> <span class="n">fNameOut</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">outputFile</span><span class="p">)</span>

    <span class="c1">## --- VTK Objs / file paths ---</span>
    <span class="k">for</span> <span class="n">iPath</span> <span class="ow">in</span> <span class="n">listOfFilePaths</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">iPath</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">iPath</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;nii&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">iPath</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;nii.gz&#39;</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">iPath</span> <span class="o">=</span> <span class="n">dcmTK</span><span class="o">.</span><span class="n">dcmVTKTK</span><span class="o">.</span><span class="n">fIO</span><span class="o">.</span><span class="n">readNifti</span><span class="p">(</span><span class="n">iPath</span><span class="p">)</span>
                <span class="n">CLEAN_UP_LIST</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iPath</span><span class="p">)</span>
            <span class="n">FILE_TO_VTK_LIST</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iPath</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">iPath</span><span class="p">):</span> <span class="c1"># If path to dicoms</span>
                <span class="n">dcmToVTKPath</span> <span class="o">=</span> <span class="n">directoryToVTI</span><span class="p">(</span><span class="n">iPath</span><span class="p">,</span> <span class="n">outputDir</span><span class="p">,</span> <span class="n">TRUE_ORIENTATION</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">ifile</span> <span class="ow">in</span> <span class="n">dcmToVTKPath</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">ifile</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.pvd&#39;</span><span class="p">):</span>
                        <span class="n">FILE_TO_VTK_LIST</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dcmTK</span><span class="o">.</span><span class="n">dcmVTKTK</span><span class="o">.</span><span class="n">fIO</span><span class="o">.</span><span class="n">readPVDFileName</span><span class="p">(</span><span class="n">ifile</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">FILE_TO_VTK_LIST</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ifile</span><span class="p">)</span>
                <span class="n">CLEAN_UP_LIST</span> <span class="o">+=</span> <span class="n">dcmToVTKPath</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> does not exist&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">iPath</span><span class="p">))</span>

    <span class="c1">## --- Build HTML Recursivly ---</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">QUIET</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Writing </span><span class="si">%s</span><span class="s1"> from base html </span><span class="si">%s</span><span class="s1">, using:&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">outputFile</span><span class="p">,</span> <span class="n">glanceHtml</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">iFile</span> <span class="ow">in</span> <span class="n">listOfFilePaths</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;    </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">iFile</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">k1</span><span class="p">,</span> <span class="n">iFile</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">FILE_TO_VTK_LIST</span><span class="p">):</span>
        <span class="n">outputTemp</span> <span class="o">=</span> <span class="n">outputFile</span><span class="p">[:</span><span class="o">-</span><span class="mi">5</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_TEMP</span><span class="si">%d</span><span class="s1">.html&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">k1</span><span class="p">)</span>
        <span class="n">glanceHtml</span> <span class="o">=</span> <span class="n">vtkToHTML</span><span class="p">(</span><span class="n">iFile</span><span class="p">,</span> <span class="n">glanceHtml</span><span class="p">,</span> <span class="n">outputTemp</span><span class="p">)</span>
        <span class="n">CLEAN_UP_LIST</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">outputTemp</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">CLEAN_UP_LIST</span><span class="o">.</span><span class="n">pop</span><span class="p">(),</span> <span class="n">outputFile</span><span class="p">)</span>

    <span class="c1">## --- Clean up --- // Skipped if in DEBUG mode</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">DEBUG</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">QUIET</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Cleaning up:&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">CLEAN_UP_LIST</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">ifile</span> <span class="ow">in</span> <span class="n">CLEAN_UP_LIST</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">iFile</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.pvd&#39;</span><span class="p">):</span>
                <span class="n">dcmTK</span><span class="o">.</span><span class="n">dcmVTKTK</span><span class="o">.</span><span class="n">fIO</span><span class="o">.</span><span class="n">deleteFilesByPVD</span><span class="p">(</span><span class="n">iFile</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">ifile</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">outputFile</span></div>



<div class="viewcode-block" id="vtkToHTML">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.spydcm.vtkToHTML">[docs]</a>
<span class="k">def</span> <span class="nf">vtkToHTML</span><span class="p">(</span><span class="n">vtkDataPath</span><span class="p">,</span> <span class="n">glanceHtml</span><span class="p">,</span> <span class="n">outputFile</span><span class="p">):</span>
    <span class="c1"># Extract data as base64</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">vtkDataPath</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">dataContent</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">base64Content</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">dataContent</span><span class="p">)</span>
        <span class="n">base64Content</span> <span class="o">=</span> <span class="n">base64Content</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="c1"># Create new output file</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">glanceHtml</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">srcHtml</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outputFile</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">dstHtml</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">srcHtml</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;&lt;/body&gt;&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">dstHtml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&lt;script&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">dstHtml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;var contentToLoad = &quot;</span><span class="si">%s</span><span class="s1">&quot;;</span><span class="se">\n\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">base64Content</span><span class="p">)</span>
                    <span class="n">dstHtml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                        <span class="s1">&#39;Glance.importBase64Dataset(&quot;</span><span class="si">%s</span><span class="s1">&quot; , contentToLoad, glanceInstance.proxyManager);</span><span class="se">\n</span><span class="s1">&#39;</span>
                        <span class="o">%</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">vtkDataPath</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="n">dstHtml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;glanceInstance.showApp();</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">dstHtml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&lt;/script&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">dstHtml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">outputFile</span></div>



<span class="c1">### ====================================================================================================================</span>
<span class="c1">##          RUN VIA MAIN</span>
<span class="c1">### ====================================================================================================================</span>
<span class="c1"># Override error to show help on argparse error (missing required argument etc)</span>
<div class="viewcode-block" id="MyParser">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.spydcm.MyParser">[docs]</a>
<span class="k">class</span> <span class="nc">MyParser</span><span class="p">(</span><span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">):</span>
<div class="viewcode-block" id="MyParser.error">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.spydcm.MyParser.error">[docs]</a>
    <span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;error: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">print_help</span><span class="p">()</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span></div>
</div>

<span class="c1">##  ========= INSPECTION / VERIFICATION =========</span>
<div class="viewcode-block" id="inspect">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.spydcm.inspect">[docs]</a>
<span class="k">def</span> <span class="nf">inspect</span><span class="p">(</span><span class="n">dStudies</span><span class="p">,</span> <span class="n">FULL</span><span class="p">):</span>
    <span class="n">frmtStr</span> <span class="o">=</span> <span class="n">dStudies</span><span class="o">.</span><span class="n">getSummaryString</span><span class="p">(</span><span class="n">FULL</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">frmtStr</span><span class="p">)</span></div>


<div class="viewcode-block" id="checkArgs">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.spydcm.checkArgs">[docs]</a>
<span class="k">def</span> <span class="nf">checkArgs</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="n">allActionArgs</span> <span class="o">=</span> <span class="p">[</span><span class="n">args</span><span class="o">.</span><span class="n">nii</span><span class="p">,</span> 
                <span class="n">args</span><span class="o">.</span><span class="n">inspect</span><span class="p">,</span> 
                <span class="n">args</span><span class="o">.</span><span class="n">inspectFull</span><span class="p">,</span> 
                <span class="n">args</span><span class="o">.</span><span class="n">inspectQuick</span><span class="p">,</span>
                <span class="n">args</span><span class="o">.</span><span class="n">outputFolder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">args</span><span class="o">.</span><span class="n">vti</span><span class="p">,</span>
                <span class="n">args</span><span class="o">.</span><span class="n">INTERACTIVE</span><span class="p">]</span>
    <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">allActionArgs</span><span class="p">)</span></div>


<span class="c1">##  ========= RUN ACTIONS =========</span>
<div class="viewcode-block" id="runActions">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.spydcm.runActions">[docs]</a>
<span class="k">def</span> <span class="nf">runActions</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">ap</span><span class="p">):</span>

    <span class="c1">####</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">dcmdump</span><span class="p">:</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">returnFirstDicomFound</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">inputPath</span><span class="p">,</span> <span class="n">FILE_NAME_ONLY</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">tagValue</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">val</span><span class="p">,</span> <span class="n">fileName</span> <span class="o">=</span> <span class="n">getTag</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">inputPath</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">tagValue</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">args</span><span class="o">.</span><span class="n">tagValue</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s2"> (found at </span><span class="si">{</span><span class="n">fileName</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">msTable</span><span class="p">:</span>
        <span class="n">outputCSV</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">outputFolder</span> <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">outputFolder</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.csv&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">outputFolder</span><span class="p">,</span> <span class="s1">&#39;ms.csv&#39;</span><span class="p">)</span>
        <span class="n">fOut</span> <span class="o">=</span> <span class="n">buildTableOfDicomParamsForManuscript</span><span class="p">([</span><span class="n">args</span><span class="o">.</span><span class="n">inputPath</span><span class="p">],</span> 
                                                    <span class="n">outputCSVPath</span><span class="o">=</span> <span class="n">outputCSV</span><span class="p">,</span>
                                                    <span class="n">seriesDescriptionIdentifier</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                                    <span class="n">ONE_FILE_PER_DIR</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Written Manuscript table like csv to </span><span class="si">{</span><span class="n">fOut</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># check arguments to avoid reading all dicoms and then doing nothing...</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">checkArgs</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
            <span class="n">ap</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;No action given. Exiting SPYDCMTK without action</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">STREAM</span><span class="p">:</span>
            <span class="n">dcmTools</span><span class="o">.</span><span class="n">streamDicoms</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">inputPath</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">outputFolder</span><span class="p">,</span> <span class="n">FORCE_READ</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">FORCE</span><span class="p">,</span> <span class="n">HIDE_PROGRESSBAR</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">QUIET</span><span class="p">,</span> <span class="n">SAFE_NAMING</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">SAFE</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">onlyOverview</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">inspect</span> <span class="ow">or</span> <span class="n">args</span><span class="o">.</span><span class="n">inspectFull</span> <span class="ow">or</span> <span class="n">args</span><span class="o">.</span><span class="n">INTERACTIVE</span>
            <span class="n">oneFilePerDir</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">inspectQuick</span> <span class="ow">or</span> <span class="n">args</span><span class="o">.</span><span class="n">INTERACTIVE</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">QUIET</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;READING...&quot;</span><span class="p">)</span>
            <span class="n">ListDicomStudies</span> <span class="o">=</span> <span class="n">dcmTK</span><span class="o">.</span><span class="n">ListOfDicomStudies</span><span class="o">.</span><span class="n">setFromInput</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">inputPath</span><span class="p">,</span> 
                                                                     <span class="n">ONE_FILE_PER_DIR</span><span class="o">=</span><span class="n">oneFilePerDir</span><span class="p">,</span>
                                                                     <span class="n">HIDE_PROGRESSBAR</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">QUIET</span><span class="p">,</span> 
                                                                     <span class="n">FORCE_READ</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">FORCE</span><span class="p">,</span> 
                                                                     <span class="n">OVERVIEW</span><span class="o">=</span><span class="n">onlyOverview</span><span class="p">)</span> 
            <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">SAFE</span><span class="p">:</span>
                <span class="n">ListDicomStudies</span><span class="o">.</span><span class="n">setSafeNameMode</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ListDicomStudies</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">ListDicomStudies</span> <span class="o">=</span> <span class="n">ListDicomStudies</span><span class="o">.</span><span class="n">filterByTag</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">filter</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">args</span><span class="o">.</span><span class="n">filter</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">newListOfDicomStudies</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">iStudy</span> <span class="ow">in</span> <span class="n">ListDicomStudies</span><span class="p">:</span> 
                        <span class="n">newListOfDicomStudies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iStudy</span><span class="o">.</span><span class="n">filterByTag</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">filter</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">args</span><span class="o">.</span><span class="n">filter</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                    <span class="n">ListDicomStudies</span> <span class="o">=</span> <span class="n">dcmTK</span><span class="o">.</span><span class="n">ListOfDicomStudies</span><span class="p">(</span><span class="n">newListOfDicomStudies</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">ap</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Error reading </span><span class="si">{</span><span class="n">args</span><span class="o">.</span><span class="n">inputPath</span><span class="si">}</span><span class="s1">.</span><span class="se">\n</span><span class="s1">    </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="c1"># Let IOERROR play out here is not correct input</span>
        <span class="c1">##</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">inspect</span> <span class="ow">or</span> <span class="n">args</span><span class="o">.</span><span class="n">inspectFull</span> <span class="ow">or</span> <span class="n">args</span><span class="o">.</span><span class="n">inspectQuick</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">iStudy</span> <span class="ow">in</span> <span class="n">ListDicomStudies</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">iStudy</span><span class="o">.</span><span class="n">getTopDir</span><span class="p">())</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">iStudy</span><span class="o">.</span><span class="n">getStudySummary</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">inspectFull</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">INTERACTIVE</span><span class="p">:</span>
            <span class="c1"># TODO - check if multiple studies</span>
            <span class="n">INTER</span> <span class="o">=</span> <span class="n">INTERACTIVE</span><span class="p">(</span><span class="n">ListDicomStudies</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">outputPath</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">outputFolder</span><span class="p">)</span>
            <span class="n">INTER</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">outputFolder</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;WARNING: outputFolder not given - setting to inputFolder&#39;</span><span class="p">)</span>
                <span class="n">args</span><span class="o">.</span><span class="n">outputFolder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">inputPath</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">nii</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">iDS</span> <span class="ow">in</span> <span class="n">ListDicomStudies</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">iSeries</span> <span class="ow">in</span> <span class="n">iDS</span><span class="p">:</span>
                        <span class="n">fOut</span> <span class="o">=</span> <span class="n">iSeries</span><span class="o">.</span><span class="n">writeToNII</span><span class="p">(</span><span class="n">outputPath</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">outputFolder</span><span class="p">)</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">QUIET</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Written </span><span class="si">{</span><span class="n">fOut</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">vti</span><span class="p">:</span>
                <span class="n">_listDicomStudiesToVTI</span><span class="p">(</span><span class="n">ListDicomStudies</span><span class="o">=</span><span class="n">ListDicomStudies</span><span class="p">,</span> <span class="n">outputFolder</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">outputFolder</span><span class="p">,</span> <span class="n">QUIET</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">QUIET</span><span class="p">,</span> <span class="n">TRUE_ORIENTATION</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">TRUE_VTI_ORIENTATION</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">vts</span><span class="p">:</span>
                <span class="n">_listDicomStudiesToVTI</span><span class="p">(</span><span class="n">ListDicomStudies</span><span class="o">=</span><span class="n">ListDicomStudies</span><span class="p">,</span> <span class="n">outputFolder</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">outputFolder</span><span class="p">,</span> <span class="n">QUIET</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">QUIET</span><span class="p">,</span> <span class="n">VTS</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">html</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">iDS</span> <span class="ow">in</span> <span class="n">ListDicomStudies</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">iSeries</span> <span class="ow">in</span> <span class="n">iDS</span><span class="p">:</span>
                        <span class="n">fOut</span> <span class="o">=</span> <span class="n">convertInputsToHTML</span><span class="p">([</span><span class="n">iSeries</span><span class="o">.</span><span class="n">getRootDir</span><span class="p">()],</span> <span class="n">args</span><span class="o">.</span><span class="n">outputFolder</span><span class="p">)</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">QUIET</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Written </span><span class="si">{</span><span class="n">fOut</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">outputFolder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">anonName</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">QUIET</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ANONYMISING...&quot;</span><span class="p">)</span>
                    <span class="n">ListDicomStudies</span><span class="o">.</span><span class="n">anonymise</span><span class="p">(</span><span class="n">anonName</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">anonName</span><span class="p">,</span> 
                                               <span class="n">anonPatientID</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">anonID</span><span class="p">,</span> 
                                               <span class="n">removePrivateTags</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">REMOVE_PRIVATE_TAGS</span><span class="p">)</span>
                    <span class="n">ListDicomStudies</span><span class="o">.</span><span class="n">resetUIDs</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">QUIET</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;WRITTING...&quot;</span><span class="p">)</span>
                <span class="n">outDirList</span> <span class="o">=</span> <span class="n">ListDicomStudies</span><span class="o">.</span><span class="n">writeToOrganisedFileStructure</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">outputFolder</span><span class="p">)</span>
                <span class="n">allDirsPresent</span> <span class="o">=</span> <span class="nb">all</span><span class="p">([</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">outDirList</span><span class="p">])</span>
                <span class="n">res</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">allDirsPresent</span> <span class="k">else</span> <span class="mi">1</span>
                <span class="n">ap</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Transfer and sort from </span><span class="si">{</span><span class="n">args</span><span class="o">.</span><span class="n">inputPath</span><span class="si">}</span><span class="s1"> to </span><span class="si">{</span><span class="n">args</span><span class="o">.</span><span class="n">outputFolder</span><span class="si">}</span><span class="s1"> COMPLETE</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></div>

        <span class="c1">##</span>

<span class="c1">### ====================================================================================================================</span>
<span class="c1">### ====================================================================================================================</span>
<span class="c1"># S T A R T</span>
<span class="c1">#</span>
<div class="viewcode-block" id="main">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.spydcm.main">[docs]</a>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="c1"># --------------------------------------------------------------------------</span>
    <span class="c1">#  ARGUMENT PARSING</span>
    <span class="c1"># --------------------------------------------------------------------------</span>
    <span class="n">ap</span> <span class="o">=</span> <span class="n">MyParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Simple Python Dicom Toolkit - spydcmtk&#39;</span><span class="p">)</span>

    <span class="n">ap</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-i&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;inputPath&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Path to find dicoms (file or directory or tar or tar.gz or zip)&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">ap</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;outputFolder&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Path for output - if set then will organise dicoms into this folder&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="n">ap</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-a&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;anonName&#39;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;anonymous name [optional - if not given, then not anoymised]&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">ap</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-aid&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;anonID&#39;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;anonymous ID [optional - only used if anonName is given, default=&quot;&quot;]&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">ap</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-RemovePrivateTags&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;REMOVE_PRIVATE_TAGS&#39;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;set to remove private tags during anonymisation [optional - only used if anonName is given, default=&quot;False&quot;]&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">)</span>
    <span class="n">ap</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-filter&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;filter&#39;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Will filter dicoms based on tag name and value. Tag name and value required. If input is multiple studies then act on each.&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">ap</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-inspect&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;inspect&#39;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Will output a summary of dicoms to the terminal&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">)</span>
    <span class="n">ap</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-inspectFull&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;inspectFull&#39;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Will output a full summary of dicoms to the terminal&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">)</span>
    <span class="n">ap</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-inspectQuick&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;inspectQuick&#39;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Run inspection - expect organised file structure (read only one file per directory)&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">)</span>
    <span class="n">ap</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-msTable&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;msTable&#39;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Will output a csv to outputFolder with tags info suitable for building manuscript style table&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">)</span>
    <span class="n">ap</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-dcmdump&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;dcmdump&#39;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Will output a dump of all dicom tags to the terminal (from first found dicom)&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">)</span>
    <span class="n">ap</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-tag&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;tagValue&#39;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Get tag value for first dicom found under input&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">ap</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-nii&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;nii&#39;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Will convert each series to nii.gz. Naming: </span><span class="si">{PName}</span><span class="s1">_{SE#}_</span><span class="si">{SEDesc}</span><span class="s1">.nii.gz&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">)</span>
    <span class="n">ap</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-vti&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;vti&#39;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Will convert each series to vti. Naming: </span><span class="si">{PName}</span><span class="s1">_{SE#}_</span><span class="si">{SEDesc}</span><span class="s1">.vti&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">)</span>
    <span class="n">ap</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-TRUE_VTI_ORIENTATION&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;TRUE_VTI_ORIENTATION&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Will resample vti data at true location (output different dimensiuons)&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">)</span>
    <span class="n">ap</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-vts&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;vts&#39;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Will convert each series to vts. Naming: </span><span class="si">{PName}</span><span class="s1">_{SE#}_</span><span class="si">{SEDesc}</span><span class="s1">.vts&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">)</span>
    <span class="n">ap</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-html&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;html&#39;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Will convert each series to html file for web viewing. Naming: outputfolder argument&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="n">ap</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-I&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;INTERACTIVE&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Will read input and launch interactive mode&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="n">ap</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-config&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;configFile&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Path to configuration file to use.&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="c1"># -- program behaviour guidence -- #</span>
    <span class="n">ap</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-SAFE&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;SAFE&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Safe naming - uses UIDs for naming to avoid potential conflicts.</span><span class="se">\n\t</span><span class="s1">&#39;</span><span class="o">+</span>\
                        <span class="s1">&#39;Note, normal behaviour is to check for safe naming but certain conditions may require this.&#39;</span><span class="p">,</span>
                            <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">)</span>
    <span class="n">ap</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-FORCE&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;FORCE&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;force reading even if not standard dicom (needed if dicom files missing header meta)&#39;</span><span class="p">,</span>
                            <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">)</span>
    <span class="n">ap</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-QUIET&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;QUIET&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Suppress progress bars and information output to terminal&#39;</span><span class="p">,</span>
                            <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">)</span>
    <span class="n">ap</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-INFO&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;INFO&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Provide setup (configuration) info and exit.&#39;</span><span class="p">,</span>
                            <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">)</span>
    <span class="n">ap</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-STREAM&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;STREAM&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;To organise dicoms rapidly without any quality checking&#39;</span><span class="p">,</span>
                            <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">)</span>
    <span class="c1">##</span>

    <span class="n">arguments</span> <span class="o">=</span> <span class="n">ap</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
    <span class="n">SpydcmTK_config</span><span class="o">.</span><span class="n">runconfigParser</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">configFile</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">INFO</span><span class="p">:</span>
        <span class="n">SpydcmTK_config</span><span class="o">.</span><span class="n">printInfo</span><span class="p">()</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">inputPath</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">arguments</span><span class="o">.</span><span class="n">inputPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">inputPath</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">inputPath</span><span class="p">)</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">inputPath</span><span class="p">)):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;## ERROR : Can not find input </span><span class="si">{</span><span class="n">arguments</span><span class="o">.</span><span class="n">inputPath</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;EXITING&#39;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">arguments</span><span class="o">.</span><span class="n">QUIET</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Running SPYDCMTK with input </span><span class="si">{</span><span class="n">arguments</span><span class="o">.</span><span class="n">inputPath</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;## ERROR : inputPath (-i option) must be provided. &#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;EXITING&#39;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1">## -------------</span>
    <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">outputFolder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">arguments</span><span class="o">.</span><span class="n">outputFolder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">outputFolder</span><span class="p">)</span>

    <span class="n">runActions</span><span class="p">(</span><span class="n">arguments</span><span class="p">,</span> <span class="n">ap</span><span class="p">)</span></div>



<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>

    <span class="n">main</span><span class="p">()</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Fraser M. Callaghan.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>