<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>spydcmtk.dcmTK &mdash; spydcmtk 1.1.5 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=a48ae3df"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            spydcmtk
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../usage/introduction.html">spydcmtk</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage/quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage/version-history.html">Version</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage/dicom-conversion.html">DICOM CONVERSION</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">spydcmtk</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">spydcmtk</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">spydcmtk.dcmTK</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for spydcmtk.dcmTK</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&quot;&quot;&quot;Classes for working with Dicom studies</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pydicom</span> <span class="k">as</span> <span class="nn">dicom</span>
<span class="kn">from</span> <span class="nn">pydicom.uid</span> <span class="kn">import</span> <span class="n">generate_uid</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">shutil</span>

<span class="c1"># Local imports </span>
<span class="kn">import</span> <span class="nn">spydcmtk.dcmTools</span> <span class="k">as</span> <span class="nn">dcmTools</span>
<span class="kn">import</span> <span class="nn">spydcmtk.dcmVTKTK</span> <span class="k">as</span> <span class="nn">dcmVTKTK</span>
<span class="kn">from</span> <span class="nn">spydcmtk.spydcm_config</span> <span class="kn">import</span> <span class="n">SpydcmTK_config</span>




<span class="c1">## =====================================================================================================================</span>
<span class="c1">##        CLASSES</span>
<span class="c1">## =====================================================================================================================</span>
<div class="viewcode-block" id="DicomSeries">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomSeries">[docs]</a>
<span class="k">class</span> <span class="nc">DicomSeries</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extends a list of ds (pydicom dataset) objects.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dsList</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">OVERVIEW</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">HIDE_PROGRESSBAR</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">FORCE_READ</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">SAFE_NAME_MODE</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialise DicomSeries with list of pydicom datasets.</span>

<span class="sd">        Args:</span>
<span class="sd">            dsList (list, optional): list of pydicom dataset. Defaults to None.</span>
<span class="sd">            OVERVIEW (bool, optional): Set True to not read pixel data, for efficiency in applications of meta </span>
<span class="sd">                                        data only interest. </span>
<span class="sd">                                        Pass to pydicom.filereader.dcmread parameter:stop_before_pixels</span>
<span class="sd">                                        Defaults to False.</span>
<span class="sd">            HIDE_PROGRESSBAR (bool, optional): Set True to hide tqdm progressbar. Defaults to False.</span>
<span class="sd">            FORCE_READ (bool, optional): Force read dicom files even if they do not conform to DICOM standard. </span>
<span class="sd">                                            Pass to pydicom.filereader.dcmread parameter:force</span>
<span class="sd">                                            Defaults to False.</span>
<span class="sd">            SAFE_NAME_MODE (bool, optional): Set writing mode to use UIDs for file naming. Defaults to False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">dsList</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dsList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">OVERVIEW</span> <span class="o">=</span> <span class="n">OVERVIEW</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">HIDE_PROGRESSBAR</span> <span class="o">=</span> <span class="n">HIDE_PROGRESSBAR</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">FORCE_READ</span> <span class="o">=</span> <span class="n">FORCE_READ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SAFE_NAME_MODE</span> <span class="o">=</span> <span class="n">SAFE_NAME_MODE</span>
        <span class="nb">list</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dsList</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return output of getSeriesOverview method</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSeriesOverview</span><span class="p">()[</span><span class="mi">1</span><span class="p">]])</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_setFromDictionary</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">dicomDict</span><span class="p">,</span> <span class="n">OVERVIEW</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">HIDE_PROGRESSBAR</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">FORCE_READ</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">dStudyList</span> <span class="o">=</span> <span class="n">ListOfDicomStudies</span><span class="o">.</span><span class="n">setFromDcmDict</span><span class="p">(</span><span class="n">dicomDict</span><span class="p">,</span> <span class="n">OVERVIEW</span><span class="o">=</span><span class="n">OVERVIEW</span><span class="p">,</span> <span class="n">HIDE_PROGRESSBAR</span><span class="o">=</span><span class="n">HIDE_PROGRESSBAR</span><span class="p">,</span> <span class="n">FORCE_READ</span><span class="o">=</span><span class="n">FORCE_READ</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dStudyList</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;More than one study found - use ListOfDicomStudies class&#39;</span><span class="p">)</span>
        <span class="n">dStudy</span> <span class="o">=</span> <span class="n">dStudyList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dStudy</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;More than one series found - use DicomStudy class&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">dStudy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">OVERVIEW</span><span class="o">=</span><span class="n">OVERVIEW</span><span class="p">,</span> <span class="n">HIDE_PROGRESSBAR</span><span class="o">=</span><span class="n">HIDE_PROGRESSBAR</span><span class="p">,</span> <span class="n">FORCE_READ</span><span class="o">=</span><span class="n">FORCE_READ</span><span class="p">)</span>

<div class="viewcode-block" id="DicomSeries.setFromDirectory">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomSeries.setFromDirectory">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">setFromDirectory</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">dirName</span><span class="p">,</span> <span class="n">OVERVIEW</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">HIDE_PROGRESSBAR</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">FORCE_READ</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ONE_FILE_PER_DIR</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialise object from directory of dicom files.</span>

<span class="sd">        Args:</span>
<span class="sd">            dirName (str): Path to directory of dicom files</span>
<span class="sd">            OVERVIEW (bool, optional): Set attribute OVERVIEW. Defaults to False.</span>
<span class="sd">            HIDE_PROGRESSBAR (bool, optional): Set attribute HIDE_PROGRESSBAR. Defaults to False.</span>
<span class="sd">            FORCE_READ (bool, optional): Set attribute FORCE_READ. Defaults to False.</span>
<span class="sd">            ONE_FILE_PER_DIR (bool, optional): Read only one file per directory for fast applications</span>
<span class="sd">                                                with meta interest only. Defaults to False.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If dicom files belonging to more than one study are found.</span>
<span class="sd">            ValueError: If dicom files belonging to more than one series are found.</span>

<span class="sd">        Returns:</span>
<span class="sd">            DicomSeries: An instance of DicomSeries class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dicomDict</span> <span class="o">=</span> <span class="n">dcmTools</span><span class="o">.</span><span class="n">organiseDicomHeirachyByUIDs</span><span class="p">(</span><span class="n">dirName</span><span class="p">,</span> <span class="n">HIDE_PROGRESSBAR</span><span class="o">=</span><span class="n">HIDE_PROGRESSBAR</span><span class="p">,</span> <span class="n">FORCE_READ</span><span class="o">=</span><span class="n">FORCE_READ</span><span class="p">,</span> <span class="n">ONE_FILE_PER_DIR</span><span class="o">=</span><span class="n">ONE_FILE_PER_DIR</span><span class="p">,</span> <span class="n">OVERVIEW</span><span class="o">=</span><span class="n">OVERVIEW</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">DicomSeries</span><span class="o">.</span><span class="n">_setFromDictionary</span><span class="p">(</span><span class="n">dicomDict</span><span class="p">,</span> <span class="n">OVERVIEW</span><span class="o">=</span><span class="n">OVERVIEW</span><span class="p">,</span> <span class="n">HIDE_PROGRESSBAR</span><span class="o">=</span><span class="n">HIDE_PROGRESSBAR</span><span class="p">,</span> <span class="n">FORCE_READ</span><span class="o">=</span><span class="n">FORCE_READ</span><span class="p">)</span></div>


<div class="viewcode-block" id="DicomSeries.setFromFileList">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomSeries.setFromFileList">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">setFromFileList</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">fileList</span><span class="p">,</span> <span class="n">OVERVIEW</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">HIDE_PROGRESSBAR</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">FORCE_READ</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialise object from list of files</span>

<span class="sd">        Args:</span>
<span class="sd">            fileList (list): List of full file names</span>
<span class="sd">            OVERVIEW (bool, optional): Set attribute OVERVIEW. Defaults to False.</span>
<span class="sd">            HIDE_PROGRESSBAR (bool, optional): Set attribute HIDE_PROGRESSBAR. Defaults to False.</span>
<span class="sd">            FORCE_READ (bool, optional): Set attribute FORCE_READ. Defaults to False.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If dicom files belonging to more than one study are found.</span>
<span class="sd">            ValueError: If dicom files belonging to more than one series are found.</span>

<span class="sd">        Returns:</span>
<span class="sd">            DicomSeries: An instance of DicomSeries class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dicomDict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">iFile</span> <span class="ow">in</span> <span class="n">fileList</span><span class="p">:</span>
            <span class="n">dcmTools</span><span class="o">.</span><span class="n">readDicomFile_intoDict</span><span class="p">(</span><span class="n">iFile</span><span class="p">,</span> <span class="n">dicomDict</span><span class="p">,</span> <span class="n">FORCE_READ</span><span class="o">=</span><span class="n">FORCE_READ</span><span class="p">,</span> <span class="n">OVERVIEW</span><span class="o">=</span><span class="n">OVERVIEW</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">DicomSeries</span><span class="o">.</span><span class="n">_setFromDictionary</span><span class="p">(</span><span class="n">dicomDict</span><span class="p">,</span> <span class="n">OVERVIEW</span><span class="o">=</span><span class="n">OVERVIEW</span><span class="p">,</span> <span class="n">HIDE_PROGRESSBAR</span><span class="o">=</span><span class="n">HIDE_PROGRESSBAR</span><span class="p">,</span> <span class="n">FORCE_READ</span><span class="o">=</span><span class="n">FORCE_READ</span><span class="p">)</span></div>


<div class="viewcode-block" id="DicomSeries.getRootDir">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomSeries.getRootDir">[docs]</a>
    <span class="k">def</span> <span class="nf">getRootDir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">filename</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span></div>


<div class="viewcode-block" id="DicomSeries.sortByInstanceNumber">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomSeries.sortByInstanceNumber">[docs]</a>
    <span class="k">def</span> <span class="nf">sortByInstanceNumber</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">dcmTools</span><span class="o">.</span><span class="n">instanceNumberSortKey</span><span class="p">)</span></div>


<div class="viewcode-block" id="DicomSeries.sortBySlice_InstanceNumber">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomSeries.sortBySlice_InstanceNumber">[docs]</a>
    <span class="k">def</span> <span class="nf">sortBySlice_InstanceNumber</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">dcmTools</span><span class="o">.</span><span class="n">sliceLoc_InstanceNumberSortKey</span><span class="p">)</span></div>


<div class="viewcode-block" id="DicomSeries.getTag">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomSeries.getTag">[docs]</a>
    <span class="k">def</span> <span class="nf">getTag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">dsID</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ifNotFound</span><span class="o">=</span><span class="s1">&#39;Unknown&#39;</span><span class="p">,</span> <span class="n">convertToType</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTagObj</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">dsID</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">convertToType</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">convertToType</span><span class="p">(</span><span class="n">tt</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">tt</span><span class="o">.</span><span class="n">value</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ifNotFound</span></div>


<div class="viewcode-block" id="DicomSeries.setTag">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomSeries.setTag">[docs]</a>
    <span class="k">def</span> <span class="nf">setTag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">ds</span><span class="o">.</span><span class="n">data_element</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span></div>


<div class="viewcode-block" id="DicomSeries.getTagObj">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomSeries.getTagObj">[docs]</a>
    <span class="k">def</span> <span class="nf">getTagObj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">dsID</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tag</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;0x&#39;</span><span class="p">:</span>
                <span class="n">tag</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">pass</span> <span class="c1"># Not string</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">dsID</span><span class="p">][</span><span class="n">tag</span><span class="p">]</span></div>


<div class="viewcode-block" id="DicomSeries.getTagValuesList">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomSeries.getTagValuesList">[docs]</a>
    <span class="k">def</span> <span class="nf">getTagValuesList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tagList</span><span class="p">,</span> <span class="n">RETURN_STR</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Build table with file name and value from each tag in list.</span>
<span class="sd">        Return list of lists</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">valueList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">dsID</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">subList</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span><span class="o">%</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">filename</span><span class="p">))]</span> <span class="o">+</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">dsID</span><span class="o">=</span><span class="n">dsID</span><span class="p">))</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tagList</span><span class="p">]</span>
            <span class="n">valueList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subList</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">RETURN_STR</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">dcmTools</span><span class="o">.</span><span class="n">_tagValuesListToString</span><span class="p">(</span><span class="n">tagList</span><span class="p">,</span> <span class="n">valueList</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">valueList</span></div>


<div class="viewcode-block" id="DicomSeries.getTagListAndNames">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomSeries.getTagListAndNames">[docs]</a>
    <span class="k">def</span> <span class="nf">getTagListAndNames</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tagList</span><span class="p">,</span> <span class="n">dsID</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="n">names</span><span class="p">,</span> <span class="n">vals</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tagList</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">dataEle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTagObj</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">dsID</span><span class="o">=</span><span class="n">dsID</span><span class="p">)</span>
                <span class="n">iname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">dataEle</span><span class="o">.</span><span class="n">keyword</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">iname</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">iname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">dataEle</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                    <span class="n">iname</span> <span class="o">=</span> <span class="n">iname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;]&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iname</span><span class="p">)</span>
                <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">dataEle</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
                <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Unknown&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">names</span><span class="p">,</span> <span class="n">vals</span></div>


<div class="viewcode-block" id="DicomSeries.tagsToJson">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomSeries.tagsToJson">[docs]</a>
    <span class="k">def</span> <span class="nf">tagsToJson</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jsonFileOut</span><span class="p">):</span>
        <span class="n">dOut</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">dd</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">to_json_dict</span><span class="p">()</span>
            <span class="n">dd</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;7FE00010&#39;</span><span class="p">)</span> <span class="c1"># Remove actual PixelData</span>
            <span class="n">dOut</span><span class="p">[</span><span class="n">ds</span><span class="o">.</span><span class="n">InstanceNumber</span><span class="p">]</span> <span class="o">=</span> <span class="n">dd</span>
        <span class="n">dcmTools</span><span class="o">.</span><span class="n">writeDictionaryToJSON</span><span class="p">(</span><span class="n">jsonFileOut</span><span class="p">,</span> <span class="n">dOut</span><span class="p">)</span></div>


<div class="viewcode-block" id="DicomSeries.getSeriesOverview">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomSeries.getSeriesOverview">[docs]</a>
    <span class="k">def</span> <span class="nf">getSeriesOverview</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tagList</span><span class="o">=</span><span class="n">SpydcmTK_config</span><span class="o">.</span><span class="n">SERIES_OVERVIEW_TAG_LIST</span><span class="p">):</span>
        <span class="n">names</span><span class="p">,</span> <span class="n">vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTagListAndNames</span><span class="p">(</span><span class="n">tagList</span><span class="p">)</span>
        <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;ImagesInSeries&#39;</span><span class="p">)</span>
        <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">names</span><span class="p">,</span> <span class="n">vals</span></div>


<div class="viewcode-block" id="DicomSeries.getSeriesTimeAsDatetime">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomSeries.getSeriesTimeAsDatetime">[docs]</a>
    <span class="k">def</span> <span class="nf">getSeriesTimeAsDatetime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">dos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="s1">&#39;SeriesDate&#39;</span><span class="p">,</span> <span class="n">ifNotFound</span><span class="o">=</span><span class="s2">&quot;19000101&quot;</span><span class="p">)</span>
        <span class="n">tos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="s1">&#39;SeriesTime&#39;</span><span class="p">,</span> <span class="n">ifNotFound</span><span class="o">=</span><span class="s2">&quot;000000&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dos</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">tos</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2"> %H%M%S.</span><span class="si">%f</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dos</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">tos</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2"> %H%M%S&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="DicomSeries.getImagePositionPatient_np">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomSeries.getImagePositionPatient_np">[docs]</a>
    <span class="k">def</span> <span class="nf">getImagePositionPatient_np</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dsID</span><span class="p">):</span>
        <span class="n">ipp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="s1">&#39;ImagePositionPatient&#39;</span><span class="p">,</span> <span class="n">dsID</span><span class="o">=</span><span class="n">dsID</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ipp</span><span class="p">)</span></div>


<div class="viewcode-block" id="DicomSeries.getImageOrientationPatient_np">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomSeries.getImageOrientationPatient_np">[docs]</a>
    <span class="k">def</span> <span class="nf">getImageOrientationPatient_np</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dsID</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="n">iop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="s1">&#39;ImageOrientationPatient&#39;</span><span class="p">,</span> <span class="n">dsID</span><span class="o">=</span><span class="n">dsID</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">iop</span><span class="p">)</span></div>


<div class="viewcode-block" id="DicomSeries.yieldDataset">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomSeries.yieldDataset">[docs]</a>
    <span class="k">def</span> <span class="nf">yieldDataset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">OVERVIEW</span><span class="p">:</span>
                <span class="k">yield</span>  <span class="n">dicom</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">stop_before_pixels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">ds</span></div>


<div class="viewcode-block" id="DicomSeries.isCompressed">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomSeries.isCompressed">[docs]</a>
    <span class="k">def</span> <span class="nf">isCompressed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">dcmTools</span><span class="o">.</span><span class="n">_isCompressed</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>


<div class="viewcode-block" id="DicomSeries.getSeriesNumber">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomSeries.getSeriesNumber">[docs]</a>
    <span class="k">def</span> <span class="nf">getSeriesNumber</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="s1">&#39;SeriesNumber&#39;</span><span class="p">,</span> <span class="n">ifNotFound</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span></div>


<div class="viewcode-block" id="DicomSeries.getSeriesOutDirName">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomSeries.getSeriesOutDirName">[docs]</a>
    <span class="k">def</span> <span class="nf">getSeriesOutDirName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">SE_RENAME</span><span class="o">=</span><span class="p">{}):</span>
        <span class="n">thisSeNum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="s1">&#39;SeriesNumber&#39;</span><span class="p">,</span> <span class="n">ifNotFound</span><span class="o">=</span><span class="s1">&#39;#&#39;</span><span class="p">)</span>
        <span class="n">suffix</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">thisSeNum</span><span class="o">==</span><span class="s2">&quot;#&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">SAFE_NAME_MODE</span><span class="p">:</span>
            <span class="n">suffix</span> <span class="o">+=</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="s2">&quot;SeriesInstanceUID&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">iTag</span> <span class="ow">in</span> <span class="n">SpydcmTK_config</span><span class="o">.</span><span class="n">SERIES_NAMING_TAG_LIST</span><span class="p">:</span>
            <span class="n">iVal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="n">iTag</span><span class="p">,</span> <span class="n">ifNotFound</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">iVal</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">suffix</span> <span class="o">+=</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">iVal</span>
        <span class="k">if</span> <span class="n">thisSeNum</span> <span class="ow">in</span> <span class="n">SE_RENAME</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">SE_RENAME</span><span class="p">[</span><span class="n">thisSeNum</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">dcmTools</span><span class="o">.</span><span class="n">cleanString</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SE</span><span class="si">{</span><span class="n">thisSeNum</span><span class="si">}{</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="DicomSeries.resetUIDs">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomSeries.resetUIDs">[docs]</a>
    <span class="k">def</span> <span class="nf">resetUIDs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">studyUID</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Reset UIDs - helpful for case of anon for analysis - but going back into PACS </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">studyUID</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">studyUID</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">generate_uid</span><span class="p">())</span>
        <span class="n">seriesUID</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">generate_uid</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">k1</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)):</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">k1</span><span class="p">]</span><span class="o">.</span><span class="n">SOPInstanceUID</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">generate_uid</span><span class="p">())</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">k1</span><span class="p">]</span><span class="o">.</span><span class="n">SeriesInstanceUID</span> <span class="o">=</span> <span class="n">seriesUID</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">k1</span><span class="p">]</span><span class="o">.</span><span class="n">StudyInstanceUID</span> <span class="o">=</span> <span class="n">studyUID</span></div>



<div class="viewcode-block" id="DicomSeries.writeToOrganisedFileStructure">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomSeries.writeToOrganisedFileStructure">[docs]</a>
    <span class="k">def</span> <span class="nf">writeToOrganisedFileStructure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">studyOutputDir</span><span class="p">,</span> <span class="n">anonName</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">anonID</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">UIDupdateDict</span><span class="o">=</span><span class="p">{},</span> <span class="n">SE_RENAME</span><span class="o">=</span><span class="p">{},</span> 
                                      <span class="n">LIKE_ORIG</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">SAFE_NAMING_CHECK</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">REMOVE_PRIVATE_TAGS</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Recurse down directory tree - grab dicoms and move to new</span>
<span class="sd">            hierarchical folder structure</span>
<span class="sd">            SE_RENAME = dict of SE# and Name to rename the SE folder    </span>
<span class="sd">            LIKE_ORIG - set to False if updated some tags</span>
<span class="sd">            REMOVE_PRIVATE_TAGS - remove private tags on anonymisation - default False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">SAFE_NAMING_CHECK</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">checkIfShouldUse_SAFE_NAMING</span><span class="p">()</span>
        <span class="n">ADD_TRANSFERSYNTAX</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">LIKE_ORIG</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">destFile</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">seriesOutDirName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSeriesOutDirName</span><span class="p">(</span><span class="n">SE_RENAME</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;SERIES OUT: &#39;</span><span class="p">,</span> <span class="n">seriesOutDirName</span><span class="p">)</span>
        <span class="n">seriesOutputDir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">studyOutputDir</span><span class="p">,</span> <span class="n">seriesOutDirName</span><span class="p">)</span>
        <span class="n">seriesOutputDirTemp</span> <span class="o">=</span> <span class="n">seriesOutputDir</span><span class="o">+</span><span class="s2">&quot;.WORKING&quot;</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">seriesOutputDir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">seriesOutputDir</span><span class="p">,</span> <span class="n">seriesOutputDirTemp</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">FORCE_READ</span><span class="p">:</span>
            <span class="n">ADD_TRANSFERSYNTAX</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1">## THIS IS A BESPOKE CHANGE</span>
        <span class="n">TO_DECOMPRESS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">isCompressed</span><span class="p">()</span>
        <span class="n">UIDupdateDict</span><span class="p">[</span><span class="s1">&#39;SeriesInstanceUID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dicom</span><span class="o">.</span><span class="n">uid</span><span class="o">.</span><span class="n">generate_uid</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yieldDataset</span><span class="p">(),</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">disable</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">HIDE_PROGRESSBAR</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">TO_DECOMPRESS</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">ds</span><span class="o">.</span><span class="n">decompress</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error with file in </span><span class="si">{</span><span class="n">seriesOutputDirTemp</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="k">continue</span>
            <span class="k">if</span> <span class="n">ADD_TRANSFERSYNTAX</span><span class="p">:</span>
                <span class="n">ds</span><span class="o">.</span><span class="n">file_meta</span><span class="o">.</span><span class="n">TransferSyntaxUID</span> <span class="o">=</span> <span class="s1">&#39;1.2.840.10008.1.2.1&#39;</span>
                <span class="n">LIKE_ORIG</span><span class="o">=</span><span class="kc">False</span>
            <span class="n">destFile</span> <span class="o">=</span> <span class="n">dcmTools</span><span class="o">.</span><span class="n">writeOut_ds</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">seriesOutputDirTemp</span><span class="p">,</span> <span class="n">anonName</span><span class="p">,</span> <span class="n">anonID</span><span class="p">,</span> <span class="n">UIDupdateDict</span><span class="p">,</span> 
                                            <span class="n">WRITE_LIKE_ORIG</span><span class="o">=</span><span class="n">LIKE_ORIG</span><span class="p">,</span> <span class="n">SAFE_NAMING</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">SAFE_NAME_MODE</span><span class="p">,</span> <span class="n">REMOVE_PRIVATE_TAGS</span><span class="o">=</span><span class="n">REMOVE_PRIVATE_TAGS</span><span class="p">)</span>
        <span class="c1"># ON COMPLETION RENAME OUTPUTDIR</span>
        <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">seriesOutputDirTemp</span><span class="p">,</span> <span class="n">seriesOutputDir</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">seriesOutputDir</span></div>


    <span class="k">def</span> <span class="nf">_generateFileName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tagsToUse</span><span class="p">,</span> <span class="n">extn</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">tagsToUse</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">fileName</span> <span class="o">=</span> <span class="n">tagsToUse</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fileName</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tagsToUse</span><span class="p">])</span>
        <span class="n">fileName</span> <span class="o">=</span> <span class="n">dcmTools</span><span class="o">.</span><span class="n">cleanString</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">extn</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">extn</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)):</span>
            <span class="n">extn</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="n">extn</span>
        <span class="k">return</span> <span class="n">fileName</span><span class="o">+</span><span class="n">extn</span>

<div class="viewcode-block" id="DicomSeries.writeToNII">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomSeries.writeToNII">[docs]</a>
    <span class="k">def</span> <span class="nf">writeToNII</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outputPath</span><span class="p">,</span> <span class="n">outputNamingTags</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;PatientName&#39;</span><span class="p">,</span> <span class="s1">&#39;SeriesNumber&#39;</span><span class="p">,</span> <span class="s1">&#39;SeriesDescription&#39;</span><span class="p">)):</span>
        <span class="n">fileName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generateFileName</span><span class="p">(</span><span class="n">outputNamingTags</span><span class="p">,</span> <span class="s1">&#39;.nii.gz&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dcmTools</span><span class="o">.</span><span class="n">writeDirectoryToNII</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getRootDir</span><span class="p">(),</span> <span class="n">outputPath</span><span class="p">,</span> <span class="n">fileName</span><span class="o">=</span><span class="n">fileName</span><span class="p">)</span></div>


<div class="viewcode-block" id="DicomSeries.writeToVTI">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomSeries.writeToVTI">[docs]</a>
    <span class="k">def</span> <span class="nf">writeToVTI</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outputPath</span><span class="p">,</span> <span class="n">outputNamingTags</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;PatientName&#39;</span><span class="p">,</span> <span class="s1">&#39;SeriesNumber&#39;</span><span class="p">,</span> <span class="s1">&#39;SeriesDescription&#39;</span><span class="p">),</span> <span class="n">INCLUDE_MATRIX</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">fileName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generateFileName</span><span class="p">(</span><span class="n">outputNamingTags</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">vtiDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">buildVTIDict</span><span class="p">(</span><span class="n">INCLUDE_MATRIX</span><span class="o">=</span><span class="n">INCLUDE_MATRIX</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dcmVTKTK</span><span class="o">.</span><span class="n">writeVTIDict</span><span class="p">(</span><span class="n">vtiDict</span><span class="p">,</span> <span class="n">outputPath</span><span class="p">,</span> <span class="n">fileName</span><span class="p">)</span></div>


<div class="viewcode-block" id="DicomSeries.writeToVTS">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomSeries.writeToVTS">[docs]</a>
    <span class="k">def</span> <span class="nf">writeToVTS</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outputPath</span><span class="p">,</span> <span class="n">outputNamingTags</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;PatientName&#39;</span><span class="p">,</span> <span class="s1">&#39;SeriesNumber&#39;</span><span class="p">,</span> <span class="s1">&#39;SeriesDescription&#39;</span><span class="p">)):</span>
        <span class="n">vtsDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">buildVTSDict</span><span class="p">()</span>
        <span class="n">fileName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generateFileName</span><span class="p">(</span><span class="n">outputNamingTags</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dcmVTKTK</span><span class="o">.</span><span class="n">writeVtkPvdDict</span><span class="p">(</span><span class="n">vtsDict</span><span class="p">,</span> <span class="n">outputPath</span><span class="p">,</span> <span class="n">filePrefix</span><span class="o">=</span><span class="n">fileName</span><span class="p">,</span> <span class="n">fileExtn</span><span class="o">=</span><span class="s1">&#39;vts&#39;</span><span class="p">,</span> <span class="n">BUILD_SUBDIR</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="DicomSeries.buildVTSDict">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomSeries.buildVTSDict">[docs]</a>
    <span class="k">def</span> <span class="nf">buildVTSDict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">vtiDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">buildVTIDict</span><span class="p">(</span><span class="n">INCLUDE_MATRIX</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">vtsDict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">ikey</span> <span class="ow">in</span> <span class="n">vtiDict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">vtsDict</span><span class="p">[</span><span class="n">ikey</span><span class="p">]</span> <span class="o">=</span> <span class="n">dcmVTKTK</span><span class="o">.</span><span class="n">vtiToVts_viaTransform</span><span class="p">(</span><span class="n">vtiDict</span><span class="p">[</span><span class="n">ikey</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">vtsDict</span></div>


<div class="viewcode-block" id="DicomSeries.buildVTIDict">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomSeries.buildVTIDict">[docs]</a>
    <span class="k">def</span> <span class="nf">buildVTIDict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">INCLUDE_MATRIX</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">A</span><span class="p">,</span> <span class="n">meta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getPixelDataAsNumpy</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">dcmVTKTK</span><span class="o">.</span><span class="n">arrToVTI</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">meta</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">INCLUDE_MATRIX</span><span class="o">=</span><span class="n">INCLUDE_MATRIX</span><span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sliceLocations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="s1">&#39;SliceLocation&#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">ifNotFound</span><span class="o">=</span><span class="mf">0.0</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))])</span>

<div class="viewcode-block" id="DicomSeries.getNumberOfSlicesPerVolume">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomSeries.getNumberOfSlicesPerVolume">[docs]</a>
    <span class="k">def</span> <span class="nf">getNumberOfSlicesPerVolume</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sliceLoc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sliceLocations</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">sliceLoc</span><span class="p">))</span></div>


<div class="viewcode-block" id="DicomSeries.getNumberOfTimeSteps">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomSeries.getNumberOfTimeSteps">[docs]</a>
    <span class="k">def</span> <span class="nf">getNumberOfTimeSteps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sliceLoc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sliceLocations</span>
        <span class="n">sliceLocS</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">sliceLoc</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sliceLoc</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">sliceLocS</span><span class="o">.</span><span class="n">pop</span><span class="p">())</span></div>


<div class="viewcode-block" id="DicomSeries.getMatrix">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomSeries.getMatrix">[docs]</a>
    <span class="k">def</span> <span class="nf">getMatrix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sortBySlice_InstanceNumber</span><span class="p">()</span>
        <span class="n">ipp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getImagePositionPatient_np</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">iop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getImageOrientationPatient_np</span><span class="p">()</span>
        <span class="n">vecC</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">iop</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">],</span> <span class="n">iop</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDeltaCol</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDeltaRow</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDeltaSlice</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">iop</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="n">dx</span><span class="p">,</span> <span class="n">iop</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">dy</span><span class="p">,</span> <span class="n">vecC</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">dz</span><span class="p">,</span> <span class="n">iop</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                         <span class="p">[</span><span class="n">iop</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">*</span><span class="n">dx</span><span class="p">,</span> <span class="n">iop</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">dy</span><span class="p">,</span> <span class="n">vecC</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">dz</span><span class="p">,</span> <span class="n">iop</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                         <span class="p">[</span><span class="n">iop</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">*</span><span class="n">dx</span><span class="p">,</span> <span class="n">iop</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">dy</span><span class="p">,</span> <span class="n">vecC</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">dz</span><span class="p">,</span> <span class="n">iop</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>
                         <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]])</span></div>


<div class="viewcode-block" id="DicomSeries.getPixelDataAsNumpy">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomSeries.getPixelDataAsNumpy">[docs]</a>
    <span class="k">def</span> <span class="nf">getPixelDataAsNumpy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get pixel data as numpy array organised by slice and time(if present).</span>
<span class="sd">            Also return dictionary of meta (&#39;Spacing&#39;, &#39;Origin&#39;, &#39;ImageOrientationPatient&#39;, &#39;Times&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">I</span><span class="p">,</span><span class="n">J</span><span class="p">,</span><span class="n">K</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="s1">&#39;Columns&#39;</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="s1">&#39;Rows&#39;</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getNumberOfSlicesPerVolume</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sortBySlice_InstanceNumber</span><span class="p">()</span>
        <span class="n">N</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNumberOfTimeSteps</span><span class="p">()</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">I</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>
        <span class="n">c0</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">k1</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">K</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">k2</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
                <span class="n">iA</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">c0</span><span class="p">]</span><span class="o">.</span><span class="n">pixel_array</span><span class="o">.</span><span class="n">T</span>
                <span class="n">A</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">]</span> <span class="o">=</span> <span class="n">iA</span>
                <span class="n">c0</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTemporalResolution</span><span class="p">()</span>
        <span class="n">meta</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Spacing&#39;</span><span class="p">:[</span><span class="bp">self</span><span class="o">.</span><span class="n">getDeltaCol</span><span class="p">()</span><span class="o">*</span><span class="mf">0.001</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDeltaRow</span><span class="p">()</span><span class="o">*</span><span class="mf">0.001</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDeltaSlice</span><span class="p">()</span><span class="o">*</span><span class="mf">0.001</span><span class="p">],</span> 
                <span class="s1">&#39;Origin&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mf">0.001</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getImagePositionPatient_np</span><span class="p">(</span><span class="mi">0</span><span class="p">)],</span> 
                <span class="s1">&#39;ImageOrientationPatient&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="s1">&#39;ImageOrientationPatient&#39;</span><span class="p">),</span> 
                <span class="s1">&#39;Times&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">dt</span><span class="o">*</span><span class="n">n</span><span class="o">*</span><span class="mf">0.001</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]}</span>
        <span class="k">return</span> <span class="n">A</span><span class="p">,</span> <span class="n">meta</span></div>


<div class="viewcode-block" id="DicomSeries.getScanDuration_secs">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomSeries.getScanDuration_secs">[docs]</a>
    <span class="k">def</span> <span class="nf">getScanDuration_secs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="mh">0x0019105a</span><span class="p">,</span> <span class="n">ifNotFound</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1000000.0</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.0</span></div>


    <span class="k">def</span> <span class="nf">_getPixelSpacing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="s1">&#39;PixelSpacing&#39;</span><span class="p">,</span> <span class="n">ifNotFound</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">])]</span>

<div class="viewcode-block" id="DicomSeries.getDeltaRow">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomSeries.getDeltaRow">[docs]</a>
    <span class="k">def</span> <span class="nf">getDeltaRow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getPixelSpacing</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span></div>


<div class="viewcode-block" id="DicomSeries.getDeltaCol">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomSeries.getDeltaCol">[docs]</a>
    <span class="k">def</span> <span class="nf">getDeltaCol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getPixelSpacing</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span></div>


<div class="viewcode-block" id="DicomSeries.getDeltaSlice">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomSeries.getDeltaSlice">[docs]</a>
    <span class="k">def</span> <span class="nf">getDeltaSlice</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sortByInstanceNumber</span><span class="p">()</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getImagePositionPatient_np</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">sliceLoc</span> <span class="o">=</span> <span class="p">[</span><span class="n">distBetweenTwoPts</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getImagePositionPatient_np</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))]</span>
        <span class="n">sliceLocS</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">sliceLoc</span><span class="p">)))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sliceLocS</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># May be CINE at same location</span>
            <span class="n">dZ</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="s1">&#39;SpacingBetweenSlices&#39;</span><span class="p">,</span> <span class="n">ifNotFound</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dZ</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">dZ</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="s1">&#39;SliceThickness&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">dZ</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">sliceLocS</span><span class="p">))</span></div>


<div class="viewcode-block" id="DicomSeries.getTemporalResolution">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomSeries.getTemporalResolution">[docs]</a>
    <span class="k">def</span> <span class="nf">getTemporalResolution</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="s1">&#39;NominalInterval&#39;</span><span class="p">,</span> <span class="n">ifNotFound</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="s1">&#39;CardiacNumberOfImages&#39;</span><span class="p">,</span> <span class="n">ifNotFound</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>       </div>


<div class="viewcode-block" id="DicomSeries.getTemporalResolution_TR_VPS">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomSeries.getTemporalResolution_TR_VPS">[docs]</a>
    <span class="k">def</span> <span class="nf">getTemporalResolution_TR_VPS</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="s1">&#39;RepetitionTime&#39;</span><span class="p">,</span> <span class="n">ifNotFound</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="mh">0x00431007</span><span class="p">,</span> <span class="n">ifNotFound</span><span class="o">=</span><span class="mf">1.0</span><span class="p">))</span></div>


<div class="viewcode-block" id="DicomSeries.getManufacturer">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomSeries.getManufacturer">[docs]</a>
    <span class="k">def</span> <span class="nf">getManufacturer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="mh">0x00080070</span><span class="p">,</span> <span class="n">ifNotFound</span><span class="o">=</span><span class="s1">&#39;Unknown&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="DicomSeries.IS_GE">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomSeries.IS_GE">[docs]</a>
    <span class="k">def</span> <span class="nf">IS_GE</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getManufacturer</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;ge&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="DicomSeries.IS_SIEMENS">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomSeries.IS_SIEMENS">[docs]</a>
    <span class="k">def</span> <span class="nf">IS_SIEMENS</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getManufacturer</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;siemens&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="DicomSeries.getPulseSequenceName">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomSeries.getPulseSequenceName">[docs]</a>
    <span class="k">def</span> <span class="nf">getPulseSequenceName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">IS_GE</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="mh">0x0019109c</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="mh">0x00180024</span><span class="p">)</span></div>


<div class="viewcode-block" id="DicomSeries.getInternalPulseSequenceName">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomSeries.getInternalPulseSequenceName">[docs]</a>
    <span class="k">def</span> <span class="nf">getInternalPulseSequenceName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="mh">0x0019109e</span><span class="p">)</span></div>


<div class="viewcode-block" id="DicomSeries.getSeriesDescription">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomSeries.getSeriesDescription">[docs]</a>
    <span class="k">def</span> <span class="nf">getSeriesDescription</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="s1">&#39;SeriesDescription&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="DicomSeries.getSeriesInfoDict">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomSeries.getSeriesInfoDict">[docs]</a>
    <span class="k">def</span> <span class="nf">getSeriesInfoDict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">EXTRA_TAGS</span><span class="o">=</span><span class="p">[]):</span>
        <span class="c1"># Default (standard tags):</span>
        <span class="n">outDict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ScanDuration&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">getScanDuration_secs</span><span class="p">(),</span>
            <span class="s1">&#39;nTime&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="s1">&#39;CardiacNumberOfImages&#39;</span><span class="p">),</span>
            <span class="s1">&#39;nRow&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="s1">&#39;Rows&#39;</span><span class="p">),</span>
            <span class="s1">&#39;nCols&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="s1">&#39;Columns&#39;</span><span class="p">),</span>
            <span class="s1">&#39;dRow&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">getDeltaRow</span><span class="p">(),</span>
            <span class="s1">&#39;dCol&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">getDeltaCol</span><span class="p">(),</span>
            <span class="s1">&#39;dSlice&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="s1">&#39;SliceThickness&#39;</span><span class="p">),</span>
            <span class="s1">&#39;dTime&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTemporalResolution</span><span class="p">(),</span>
            <span class="s1">&#39;SpacingBetweenSlices&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="s1">&#39;SpacingBetweenSlices&#39;</span><span class="p">),</span>
            <span class="s1">&#39;FlipAngle&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="s1">&#39;FlipAngle&#39;</span><span class="p">),</span>
            <span class="s1">&#39;HeartRate&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="s1">&#39;HeartRate&#39;</span><span class="p">),</span>
            <span class="s1">&#39;EchoTime&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="s1">&#39;EchoTime&#39;</span><span class="p">),</span>
            <span class="s1">&#39;RepetitionTime&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="s1">&#39;RepetitionTime&#39;</span><span class="p">),</span>
            <span class="s1">&#39;PulseSequenceName&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">getPulseSequenceName</span><span class="p">(),</span>
            <span class="s1">&#39;MagneticFieldStrength&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="s1">&#39;MagneticFieldStrength&#39;</span><span class="p">),</span>
            <span class="s1">&#39;InternalPulseSequenceName&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">getInternalPulseSequenceName</span><span class="p">(),</span>
            <span class="s1">&#39;ReconstructionDiameter&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="mh">0x00181100</span><span class="p">),</span>
            <span class="s1">&#39;AcquisitionMatrix&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="mh">0x00181310</span><span class="p">)),</span>
            <span class="s1">&#39;Manufacturer&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="s2">&quot;Manufacturer&quot;</span><span class="p">),</span>
            <span class="s1">&#39;ManufacturerModelName&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="s2">&quot;ManufacturerModelName&quot;</span><span class="p">),</span>
            <span class="s1">&#39;SoftwareVersions&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="mh">0x00181020</span><span class="p">)),}</span>
        <span class="k">for</span> <span class="n">extraTag</span> <span class="ow">in</span> <span class="n">EXTRA_TAGS</span><span class="p">:</span>
            <span class="n">outDict</span><span class="p">[</span><span class="n">extraTag</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="n">extraTag</span><span class="p">)</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;nSlice&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;AcquiredResolution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;ReconstructionDiameter&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="mh">0x00181310</span><span class="p">)))</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;AcquiredResolution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;dRow&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;dCol&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;AcquiredTemporalResolution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTemporalResolution_TR_VPS</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;AcquiredTemporalResolution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">outDict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;,&#39;</span> <span class="ow">in</span> <span class="n">outDict</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                    <span class="n">outDict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">outDict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">return</span> <span class="n">outDict</span></div>


<div class="viewcode-block" id="DicomSeries.checkIfShouldUse_SAFE_NAMING">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomSeries.checkIfShouldUse_SAFE_NAMING">[docs]</a>
    <span class="k">def</span> <span class="nf">checkIfShouldUse_SAFE_NAMING</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">se_instance_set</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">se_instance_set</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">se_instance_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k1</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)):</span>
            <span class="n">se</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="s1">&#39;SeriesNumber&#39;</span><span class="p">,</span> <span class="n">dsID</span><span class="o">=</span><span class="n">k1</span><span class="p">,</span> <span class="n">ifNotFound</span><span class="o">=</span><span class="s1">&#39;unknown&#39;</span><span class="p">)</span>
            <span class="n">instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="s1">&#39;InstanceNumber&#39;</span><span class="p">,</span> <span class="n">dsID</span><span class="o">=</span><span class="n">k1</span><span class="p">,</span> <span class="n">ifNotFound</span><span class="o">=</span><span class="s1">&#39;unknown&#39;</span><span class="p">)</span>
            <span class="n">se_instance_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">se</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">instance</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">se_instance_str</span> <span class="ow">in</span> <span class="n">se_instance_set</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">SAFE_NAME_MODE</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>
            <span class="n">se_instance_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">se_instance_str</span><span class="p">)</span></div>


<div class="viewcode-block" id="DicomSeries.getStudyOutputDir">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomSeries.getStudyOutputDir">[docs]</a>
    <span class="k">def</span> <span class="nf">getStudyOutputDir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rootDir</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">anonName</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">studyPrefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="c1"># &#39;AccessionNumber&#39; &#39;StudyID&#39;</span>
        <span class="n">suffix</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">SAFE_NAME_MODE</span><span class="p">:</span>
            <span class="n">suffix</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="s1">&#39;StudyInstanceUID&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">for</span> <span class="n">iTag</span> <span class="ow">in</span> <span class="n">SpydcmTK_config</span><span class="o">.</span><span class="n">STUDY_NAMING_TAG_LIST</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">anonName</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="ow">in</span> <span class="n">iTag</span><span class="o">.</span><span class="n">lower</span><span class="p">()):</span>
                <span class="k">continue</span>
            <span class="n">iVal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="n">iTag</span><span class="p">,</span> <span class="n">ifNotFound</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">convertToType</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">iVal</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">suffix</span> <span class="o">+=</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">iVal</span>
        <span class="k">if</span> <span class="n">anonName</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">suffix</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">anonName</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">suffix</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rootDir</span><span class="p">,</span> <span class="n">dcmTools</span><span class="o">.</span><span class="n">cleanString</span><span class="p">(</span><span class="n">studyPrefix</span><span class="o">+</span><span class="n">suffix</span><span class="p">))</span></div>
</div>


<div class="viewcode-block" id="DicomStudy">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomStudy">[docs]</a>
<span class="k">class</span> <span class="nc">DicomStudy</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extends list of DicomSeries objects (creating list of list of pydicom.dataset)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dSeriesList</span><span class="p">,</span> <span class="n">OVERVIEW</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">HIDE_PROGRESSBAR</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set OVERVIEW = False to read pixel data as well (at a cost)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">OVERVIEW</span> <span class="o">=</span> <span class="n">OVERVIEW</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">HIDE_PROGRESSBAR</span> <span class="o">=</span> <span class="n">HIDE_PROGRESSBAR</span> <span class="c1"># FIXME - if set need ot pass down to series also - for the writing</span>
        <span class="nb">list</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dSeriesList</span><span class="p">)</span>

<div class="viewcode-block" id="DicomStudy.setFromDictionary">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomStudy.setFromDictionary">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">setFromDictionary</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">dicomDict</span><span class="p">,</span> <span class="n">OVERVIEW</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">HIDE_PROGRESSBAR</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">FORCE_READ</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">dStudyList</span> <span class="o">=</span> <span class="n">ListOfDicomStudies</span><span class="o">.</span><span class="n">setFromDcmDict</span><span class="p">(</span><span class="n">dicomDict</span><span class="p">,</span> <span class="n">OVERVIEW</span><span class="o">=</span><span class="n">OVERVIEW</span><span class="p">,</span> <span class="n">HIDE_PROGRESSBAR</span><span class="o">=</span><span class="n">HIDE_PROGRESSBAR</span><span class="p">,</span> <span class="n">FORCE_READ</span><span class="o">=</span><span class="n">FORCE_READ</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dStudyList</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;More than one study found - use ListOfDicomStudies class&#39;</span><span class="p">)</span>
        <span class="c1"># dicomDirs = getAllDirsUnderRootWithDicoms(dirName) # this was meant to work as a quick shortcut - but potential problems if used incorrectly</span>
        <span class="c1"># dSeriesList = []</span>
        <span class="c1"># for iDir in dicomDirs:</span>
        <span class="c1">#     dSeriesList.append(DicomSeries.setFromDirectory(iDir, OVERVIEW=OVERVIEW, HIDE_PROGRESSBAR=HIDE_PROGRESSBAR))</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">dStudyList</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">OVERVIEW</span><span class="o">=</span><span class="n">OVERVIEW</span><span class="p">,</span> <span class="n">HIDE_PROGRESSBAR</span><span class="o">=</span><span class="n">HIDE_PROGRESSBAR</span><span class="p">)</span></div>


<div class="viewcode-block" id="DicomStudy.setFromDirectory">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomStudy.setFromDirectory">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">setFromDirectory</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">dirName</span><span class="p">,</span> <span class="n">OVERVIEW</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">HIDE_PROGRESSBAR</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">FORCE_READ</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ONE_FILE_PER_DIR</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">dicomDict</span> <span class="o">=</span> <span class="n">dcmTools</span><span class="o">.</span><span class="n">organiseDicomHeirachyByUIDs</span><span class="p">(</span><span class="n">dirName</span><span class="p">,</span> <span class="n">HIDE_PROGRESSBAR</span><span class="o">=</span><span class="n">HIDE_PROGRESSBAR</span><span class="p">,</span> <span class="n">FORCE_READ</span><span class="o">=</span><span class="n">FORCE_READ</span><span class="p">,</span> <span class="n">ONE_FILE_PER_DIR</span><span class="o">=</span><span class="n">ONE_FILE_PER_DIR</span><span class="p">,</span> <span class="n">OVERVIEW</span><span class="o">=</span><span class="n">OVERVIEW</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">DicomStudy</span><span class="o">.</span><span class="n">setFromDictionary</span><span class="p">(</span><span class="n">dicomDict</span><span class="p">,</span> <span class="n">OVERVIEW</span><span class="o">=</span><span class="n">OVERVIEW</span><span class="p">,</span> <span class="n">HIDE_PROGRESSBAR</span><span class="o">=</span><span class="n">HIDE_PROGRESSBAR</span><span class="p">,</span> <span class="n">FORCE_READ</span><span class="o">=</span><span class="n">FORCE_READ</span><span class="p">)</span></div>



    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">: </span><span class="si">%d</span><span class="s1"> series, </span><span class="si">%d</span><span class="s1"> dicoms&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="s1">&#39;PatientName&#39;</span><span class="p">),</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="s1">&#39;SeriesDescription&#39;</span><span class="p">),</span>
                                                <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">getNumberOfDicoms</span><span class="p">())</span>


<div class="viewcode-block" id="DicomStudy.setSafeNameMode">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomStudy.setSafeNameMode">[docs]</a>
    <span class="k">def</span> <span class="nf">setSafeNameMode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">iSeries</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">iSeries</span><span class="o">.</span><span class="n">SAFE_NAME_MODE</span> <span class="o">=</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="DicomStudy.getTag">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomStudy.getTag">[docs]</a>
    <span class="k">def</span> <span class="nf">getTag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">seriesID</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">instanceID</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ifNotFound</span><span class="o">=</span><span class="s1">&#39;Unknown&#39;</span><span class="p">,</span> <span class="n">convertToType</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">seriesID</span><span class="p">]</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">dsID</span><span class="o">=</span><span class="n">instanceID</span><span class="p">,</span> <span class="n">ifNotFound</span><span class="o">=</span><span class="n">ifNotFound</span><span class="p">,</span> <span class="n">convertToType</span><span class="o">=</span><span class="n">convertToType</span><span class="p">)</span></div>


<div class="viewcode-block" id="DicomStudy.getTagListAndNames">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomStudy.getTagListAndNames">[docs]</a>
    <span class="k">def</span> <span class="nf">getTagListAndNames</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tagList</span><span class="p">,</span> <span class="n">seriesID</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">instanceID</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">seriesID</span><span class="p">]</span><span class="o">.</span><span class="n">getTagListAndNames</span><span class="p">(</span><span class="n">tagList</span><span class="p">,</span> <span class="n">dsID</span><span class="o">=</span><span class="n">instanceID</span><span class="p">)</span></div>


<div class="viewcode-block" id="DicomStudy.isCompressed">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomStudy.isCompressed">[docs]</a>
    <span class="k">def</span> <span class="nf">isCompressed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isCompressed</span><span class="p">()</span></div>


<div class="viewcode-block" id="DicomStudy.getNumberOfDicoms">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomStudy.getNumberOfDicoms">[docs]</a>
    <span class="k">def</span> <span class="nf">getNumberOfDicoms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">])</span></div>


<div class="viewcode-block" id="DicomStudy.getTopDir">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomStudy.getTopDir">[docs]</a>
    <span class="k">def</span> <span class="nf">getTopDir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">filename</span><span class="p">)[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span></div>


<div class="viewcode-block" id="DicomStudy.getSeriesMatchingDescription">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomStudy.getSeriesMatchingDescription">[docs]</a>
    <span class="k">def</span> <span class="nf">getSeriesMatchingDescription</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">matchingStrList</span><span class="p">,</span> <span class="n">RETURN_SERIES_OBJ</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">REDUCE_MULTIPLE</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">matchStrList_lower</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">matchingStrList</span><span class="p">]</span>
        <span class="n">possibles</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">sDesc</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="s1">&#39;SeriesDescription&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">j</span> <span class="ow">in</span> <span class="n">sDesc</span>  <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">matchStrList_lower</span> <span class="p">]):</span>
                <span class="n">possibles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">minID</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">possibles</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">possibles</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">REDUCE_MULTIPLE</span><span class="p">:</span>
            <span class="n">seNums</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="s1">&#39;SeriesNumber&#39;</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">possibles</span><span class="p">]</span>
            <span class="n">seNums</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">seNums</span> <span class="k">if</span> <span class="n">i</span><span class="o">!=</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">k1</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">seNums</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">seNums</span><span class="p">[</span><span class="n">k1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">seNums</span><span class="p">[</span><span class="n">minID</span><span class="p">]:</span>
                    <span class="n">minID</span> <span class="o">=</span> <span class="n">k1</span>
        <span class="k">if</span> <span class="n">minID</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">possibles</span> <span class="o">=</span> <span class="n">possibles</span><span class="p">[</span><span class="n">minID</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">RETURN_SERIES_OBJ</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">possibles</span>
        <span class="k">return</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;SE</span><span class="si">{</span><span class="n">possibles</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="s2">&quot;SeriesnNumber&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="n">possibles</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="s2">&quot;SeriesDescription&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">possibles</span><span class="p">))]</span></div>


<div class="viewcode-block" id="DicomStudy.getStudyOverview">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomStudy.getStudyOverview">[docs]</a>
    <span class="k">def</span> <span class="nf">getStudyOverview</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tagList</span><span class="o">=</span><span class="n">SpydcmTK_config</span><span class="o">.</span><span class="n">STUDY_OVERVIEW_TAG_LIST</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTagListAndNames</span><span class="p">(</span><span class="n">tagList</span><span class="p">)</span></div>


<div class="viewcode-block" id="DicomStudy.getPatientOverview">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomStudy.getPatientOverview">[docs]</a>
    <span class="k">def</span> <span class="nf">getPatientOverview</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tagList</span><span class="o">=</span><span class="n">SpydcmTK_config</span><span class="o">.</span><span class="n">SUBJECT_OVERVIEW_TAG_LIST</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTagListAndNames</span><span class="p">(</span><span class="n">tagList</span><span class="p">)</span></div>


<div class="viewcode-block" id="DicomStudy.getSeriesByID">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomStudy.getSeriesByID">[docs]</a>
    <span class="k">def</span> <span class="nf">getSeriesByID</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ID</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">iSeries</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">iSeries</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="s1">&#39;SeriesNumber&#39;</span><span class="p">))</span> <span class="o">==</span> <span class="n">ID</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">iSeries</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span> <span class="c1"># If SE# == None (report of Sec Capture etc)</span>
                <span class="k">pass</span></div>


<div class="viewcode-block" id="DicomStudy.getSeriesBySeriesNumber">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomStudy.getSeriesBySeriesNumber">[docs]</a>
    <span class="k">def</span> <span class="nf">getSeriesBySeriesNumber</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seNum</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSeriesByID</span><span class="p">(</span><span class="n">seNum</span><span class="p">)</span></div>


<div class="viewcode-block" id="DicomStudy.getSeriesByUID">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomStudy.getSeriesByUID">[docs]</a>
    <span class="k">def</span> <span class="nf">getSeriesByUID</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">UID</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">iSeries</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">iSeries</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="s1">&#39;SeriesInstanceUID&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">UID</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">iSeries</span></div>


<div class="viewcode-block" id="DicomStudy.getStudySummaryDict">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomStudy.getStudySummaryDict">[docs]</a>
    <span class="k">def</span> <span class="nf">getStudySummaryDict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">FORCE_STRING_KEYS</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">pt</span><span class="p">,</span><span class="n">pv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getPatientOverview</span><span class="p">()</span>
        <span class="n">studySummaryDict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="n">pv</span><span class="p">))</span>
        <span class="n">st</span><span class="p">,</span><span class="n">sv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStudyOverview</span><span class="p">()</span>
        <span class="n">stdyDict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">st</span><span class="p">,</span> <span class="n">sv</span><span class="p">))</span>
        <span class="n">studySummaryDict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">stdyDict</span><span class="p">)</span>
        <span class="n">listSerDict</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">szt</span><span class="p">,</span> <span class="n">szv</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">getSeriesOverview</span><span class="p">()</span>
            <span class="n">listSerDict</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">szt</span><span class="p">,</span> <span class="n">szv</span><span class="p">)))</span>
        <span class="n">studySummaryDict</span><span class="p">[</span><span class="s1">&#39;Series&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">listSerDict</span>
        <span class="k">return</span> <span class="n">studySummaryDict</span></div>


<div class="viewcode-block" id="DicomStudy.getStudySummary">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomStudy.getStudySummary">[docs]</a>
    <span class="k">def</span> <span class="nf">getStudySummary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">FULL</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">pt</span><span class="p">,</span><span class="n">pv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getPatientOverview</span><span class="p">()</span>
        <span class="n">patStr</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39; </span><span class="si">%s</span><span class="s1">:</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span><span class="n">pv</span><span class="p">)])</span>
        <span class="n">st</span><span class="p">,</span><span class="n">sv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStudyOverview</span><span class="p">()</span>
        <span class="n">studyStr</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39; </span><span class="si">%s</span><span class="s1">:</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">st</span><span class="p">,</span><span class="n">sv</span><span class="p">)])</span>
        <span class="k">if</span> <span class="n">FULL</span><span class="p">:</span>
            <span class="n">sst</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getSeriesOverview</span><span class="p">()</span>
            <span class="n">seriesHeader</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sst</span><span class="p">])</span>
            <span class="n">seriesStr</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i2</span><span class="p">)</span> <span class="k">for</span> <span class="n">i2</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">getSeriesOverview</span><span class="p">()[</span><span class="mi">1</span><span class="p">]])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">seriesStr</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">seriesStr</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">i</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">pass</span> <span class="c1"># Try to sort, but if fail (due to return not int somehow, then no sort)</span>
            <span class="k">return</span> <span class="s1">&#39;SUBJECT:</span><span class="si">%s</span><span class="se">\n</span><span class="s1">STUDY:</span><span class="si">%s</span><span class="se">\n</span><span class="s1">    </span><span class="si">%s</span><span class="se">\n</span><span class="s1">    </span><span class="si">%s</span><span class="se">\n</span><span class="s1">Total: </span><span class="si">%d</span><span class="s1"> images&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">patStr</span><span class="p">,</span> <span class="n">studyStr</span><span class="p">,</span> <span class="n">seriesHeader</span><span class="p">,</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">    &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">seriesStr</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNumberOfDicoms</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;SUBJECT:</span><span class="si">%s</span><span class="se">\n</span><span class="s1">STUDY:</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">patStr</span><span class="p">,</span> <span class="n">studyStr</span><span class="p">)</span></div>


<div class="viewcode-block" id="DicomStudy.getTagValuesList">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomStudy.getTagValuesList">[docs]</a>
    <span class="k">def</span> <span class="nf">getTagValuesList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tagList</span><span class="p">,</span> <span class="n">RETURN_STR</span><span class="p">):</span>
        <span class="n">output</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">+=</span> <span class="n">i</span><span class="o">.</span><span class="n">getTagValuesList</span><span class="p">(</span><span class="n">tagList</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">RETURN_STR</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">dcmTools</span><span class="o">.</span><span class="n">_tagValuesListToString</span><span class="p">(</span><span class="n">tagList</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">output</span></div>


<div class="viewcode-block" id="DicomStudy.writeToOrganisedFileStructure">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomStudy.writeToOrganisedFileStructure">[docs]</a>
    <span class="k">def</span> <span class="nf">writeToOrganisedFileStructure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patientOutputDir</span><span class="p">,</span> <span class="n">anonName</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">anonID</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">SE_RENAME</span><span class="o">=</span><span class="p">{},</span> <span class="n">studyPrefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">REMOVE_PRIVATE_TAGS</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkIfShouldUse_SAFE_NAMING</span><span class="p">()</span>
        <span class="n">studyOutputDir</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getStudyOutputDir</span><span class="p">(</span><span class="n">patientOutputDir</span><span class="p">,</span> <span class="n">anonName</span><span class="p">,</span> <span class="n">studyPrefix</span><span class="p">)</span>
        <span class="n">studyOutputDirTemp</span> <span class="o">=</span> <span class="n">studyOutputDir</span><span class="o">+</span><span class="s2">&quot;.WORKING&quot;</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">studyOutputDir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">studyOutputDir</span><span class="p">,</span> <span class="n">studyOutputDirTemp</span><span class="p">)</span>
        <span class="n">UIDupdateDict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;StudyInstanceUID&#39;</span><span class="p">:</span> <span class="n">dicom</span><span class="o">.</span><span class="n">uid</span><span class="o">.</span><span class="n">generate_uid</span><span class="p">()}</span>
        <span class="k">for</span> <span class="n">iSeries</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">iSeries</span><span class="o">.</span><span class="n">writeToOrganisedFileStructure</span><span class="p">(</span><span class="n">studyOutputDirTemp</span><span class="p">,</span> <span class="n">anonName</span><span class="o">=</span><span class="n">anonName</span><span class="p">,</span> <span class="n">anonID</span><span class="o">=</span><span class="n">anonID</span><span class="p">,</span> 
                                                  <span class="n">UIDupdateDict</span><span class="o">=</span><span class="n">UIDupdateDict</span><span class="p">,</span> <span class="n">SE_RENAME</span><span class="o">=</span><span class="n">SE_RENAME</span><span class="p">,</span> 
                                                  <span class="n">SAFE_NAMING_CHECK</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">REMOVE_PRIVATE_TAGS</span><span class="o">=</span><span class="n">REMOVE_PRIVATE_TAGS</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">studyOutputDirTemp</span><span class="p">,</span> <span class="n">studyOutputDir</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">studyOutputDir</span></div>


<div class="viewcode-block" id="DicomStudy.writeToZipArchive">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomStudy.writeToZipArchive">[docs]</a>
    <span class="k">def</span> <span class="nf">writeToZipArchive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patientOutputDir</span><span class="p">,</span> <span class="n">anonName</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">anonID</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">SE_RENAME</span><span class="o">=</span><span class="p">{},</span> <span class="n">studyPrefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">CLEAN_UP</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">REMOVE_PRIVATE_TAGS</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">studyOutputDir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeToOrganisedFileStructure</span><span class="p">(</span><span class="n">patientOutputDir</span><span class="p">,</span> <span class="n">anonName</span><span class="p">,</span> <span class="n">anonID</span><span class="p">,</span> <span class="n">SE_RENAME</span><span class="p">,</span> <span class="n">studyPrefix</span><span class="p">,</span> 
                                                            <span class="n">REMOVE_PRIVATE_TAGS</span><span class="o">=</span><span class="n">REMOVE_PRIVATE_TAGS</span><span class="p">)</span>
        <span class="n">r</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">studyOutputDir</span><span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">make_archive</span><span class="p">(</span><span class="n">studyOutputDir</span><span class="p">,</span> <span class="s1">&#39;zip&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span>
        <span class="n">fileOut</span> <span class="o">=</span> <span class="n">studyOutputDir</span><span class="o">+</span><span class="s1">&#39;.zip&#39;</span>
        <span class="k">if</span> <span class="n">CLEAN_UP</span><span class="p">:</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">studyOutputDir</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fileOut</span></div>


<div class="viewcode-block" id="DicomStudy.checkIfShouldUse_SAFE_NAMING">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.DicomStudy.checkIfShouldUse_SAFE_NAMING">[docs]</a>
    <span class="k">def</span> <span class="nf">checkIfShouldUse_SAFE_NAMING</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">se_instance_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">i</span><span class="o">.</span><span class="n">checkIfShouldUse_SAFE_NAMING</span><span class="p">(</span><span class="n">se_instance_set</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="ListOfDicomStudies">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.ListOfDicomStudies">[docs]</a>
<span class="k">class</span> <span class="nc">ListOfDicomStudies</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extends list of DicomStudies objects (creating list of list of list of pydicom.dataset)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dStudiesList</span><span class="p">,</span> <span class="n">OVERVIEW</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">HIDE_PROGRESSBAR</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set OVERVIEW = False to read pixel data as well (at a cost)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">OVERVIEW</span> <span class="o">=</span> <span class="n">OVERVIEW</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">HIDE_PROGRESSBAR</span> <span class="o">=</span> <span class="n">HIDE_PROGRESSBAR</span>
        <span class="nb">list</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dStudiesList</span><span class="p">)</span>

<div class="viewcode-block" id="ListOfDicomStudies.setFromInput">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.ListOfDicomStudies.setFromInput">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">setFromInput</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="nb">input</span><span class="p">,</span> <span class="n">OVERVIEW</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">HIDE_PROGRESSBAR</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">FORCE_READ</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ONE_FILE_PER_DIR</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="nb">input</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">ListOfDicomStudies</span><span class="o">.</span><span class="n">setFromDirectory</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">OVERVIEW</span><span class="o">=</span><span class="n">OVERVIEW</span><span class="p">,</span> 
                                                                <span class="n">HIDE_PROGRESSBAR</span><span class="o">=</span><span class="n">HIDE_PROGRESSBAR</span><span class="p">,</span> 
                                                                <span class="n">FORCE_READ</span><span class="o">=</span><span class="n">FORCE_READ</span><span class="p">,</span> 
                                                                <span class="n">ONE_FILE_PER_DIR</span><span class="o">=</span><span class="n">ONE_FILE_PER_DIR</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="nb">input</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">input</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;tar&#39;</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">ListOfDicomStudies</span><span class="o">.</span><span class="n">setFromTar</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">HIDE_PROGRESSBAR</span><span class="o">=</span><span class="n">HIDE_PROGRESSBAR</span><span class="p">,</span> 
                                                            <span class="n">FORCE_READ</span><span class="o">=</span><span class="n">FORCE_READ</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">input</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;tar.gz&#39;</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">ListOfDicomStudies</span><span class="o">.</span><span class="n">setFromTar</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">HIDE_PROGRESSBAR</span><span class="o">=</span><span class="n">HIDE_PROGRESSBAR</span><span class="p">,</span> 
                                                            <span class="n">FORCE_READ</span><span class="o">=</span><span class="n">FORCE_READ</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">input</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;zip&#39;</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">ListOfDicomStudies</span><span class="o">.</span><span class="n">setFromZip</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">HIDE_PROGRESSBAR</span><span class="o">=</span><span class="n">HIDE_PROGRESSBAR</span><span class="p">,</span> 
                                                            <span class="n">FORCE_READ</span><span class="o">=</span><span class="n">FORCE_READ</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dcmDict</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">dcmTools</span><span class="o">.</span><span class="n">readDicomFile_intoDict</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">dcmDict</span><span class="p">,</span> <span class="n">FORCE_READ</span><span class="o">=</span><span class="n">FORCE_READ</span><span class="p">,</span> <span class="n">OVERVIEW</span><span class="o">=</span><span class="n">OVERVIEW</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">ListOfDicomStudies</span><span class="o">.</span><span class="n">setFromDcmDict</span><span class="p">(</span><span class="n">dcmDict</span><span class="p">,</span> <span class="n">OVERVIEW</span><span class="p">,</span> <span class="n">HIDE_PROGRESSBAR</span><span class="p">,</span> <span class="n">FORCE_READ</span><span class="o">=</span><span class="n">FORCE_READ</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">dicom</span><span class="o">.</span><span class="n">filereader</span><span class="o">.</span><span class="n">InvalidDicomError</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;ERROR READING DICOMS: SPDCMTK capable to read dicom files from directory, zip, tar or tar.gz</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="ListOfDicomStudies.setFromDirectory">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.ListOfDicomStudies.setFromDirectory">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">setFromDirectory</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">dirName</span><span class="p">,</span> <span class="n">OVERVIEW</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">HIDE_PROGRESSBAR</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">FORCE_READ</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ONE_FILE_PER_DIR</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">dicomDict</span> <span class="o">=</span> <span class="n">dcmTools</span><span class="o">.</span><span class="n">organiseDicomHeirachyByUIDs</span><span class="p">(</span><span class="n">dirName</span><span class="p">,</span> <span class="n">HIDE_PROGRESSBAR</span><span class="o">=</span><span class="n">HIDE_PROGRESSBAR</span><span class="p">,</span> <span class="n">FORCE_READ</span><span class="o">=</span><span class="n">FORCE_READ</span><span class="p">,</span> <span class="n">ONE_FILE_PER_DIR</span><span class="o">=</span><span class="n">ONE_FILE_PER_DIR</span><span class="p">,</span> <span class="n">OVERVIEW</span><span class="o">=</span><span class="n">OVERVIEW</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ListOfDicomStudies</span><span class="o">.</span><span class="n">setFromDcmDict</span><span class="p">(</span><span class="n">dicomDict</span><span class="p">,</span> <span class="n">OVERVIEW</span><span class="p">,</span> <span class="n">HIDE_PROGRESSBAR</span><span class="p">,</span> <span class="n">FORCE_READ</span><span class="o">=</span><span class="n">FORCE_READ</span><span class="p">)</span></div>


<div class="viewcode-block" id="ListOfDicomStudies.setFromDcmDict">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.ListOfDicomStudies.setFromDcmDict">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">setFromDcmDict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">dicomDict</span><span class="p">,</span> <span class="n">OVERVIEW</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">HIDE_PROGRESSBAR</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">FORCE_READ</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">dStudiesList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">studyUID</span> <span class="ow">in</span> <span class="n">dicomDict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">dSeriesList</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">seriesUID</span> <span class="ow">in</span> <span class="n">dicomDict</span><span class="p">[</span><span class="n">studyUID</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">dSeriesList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">DicomSeries</span><span class="p">(</span><span class="n">dicomDict</span><span class="p">[</span><span class="n">studyUID</span><span class="p">][</span><span class="n">seriesUID</span><span class="p">],</span> <span class="n">OVERVIEW</span><span class="o">=</span><span class="n">OVERVIEW</span><span class="p">,</span> <span class="n">HIDE_PROGRESSBAR</span><span class="o">=</span><span class="n">HIDE_PROGRESSBAR</span><span class="p">,</span> <span class="n">FORCE_READ</span><span class="o">=</span><span class="n">FORCE_READ</span><span class="p">))</span>
            <span class="n">dStudiesList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">DicomStudy</span><span class="p">(</span><span class="n">dSeriesList</span><span class="p">,</span> <span class="n">OVERVIEW</span><span class="p">,</span> <span class="n">HIDE_PROGRESSBAR</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">dStudiesList</span><span class="p">,</span> <span class="n">OVERVIEW</span><span class="p">,</span> <span class="n">HIDE_PROGRESSBAR</span><span class="p">)</span></div>


<div class="viewcode-block" id="ListOfDicomStudies.setFromTar">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.ListOfDicomStudies.setFromTar">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">setFromTar</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">tarFileName</span><span class="p">,</span> <span class="n">HIDE_PROGRESSBAR</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">FORCE_READ</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">FIRST_ONLY</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">matchTagPair</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># Note need OVERVIEW = False as only get access to file (and pixels) on untaring (maybe only if tar.gz) </span>
        <span class="n">dicomDict</span> <span class="o">=</span> <span class="n">dcmTools</span><span class="o">.</span><span class="n">getDicomDictFromTar</span><span class="p">(</span><span class="n">tarFileName</span><span class="p">,</span> <span class="n">FORCE_READ</span><span class="o">=</span><span class="n">FORCE_READ</span><span class="p">,</span> <span class="n">FIRST_ONLY</span><span class="o">=</span><span class="n">FIRST_ONLY</span><span class="p">,</span> <span class="n">OVERVIEW_ONLY</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                    <span class="n">matchingTagValuePair</span><span class="o">=</span><span class="n">matchTagPair</span><span class="p">,</span> <span class="n">QUIET</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ListOfDicomStudies</span><span class="o">.</span><span class="n">setFromDcmDict</span><span class="p">(</span><span class="n">dicomDict</span><span class="p">,</span> <span class="n">HIDE_PROGRESSBAR</span><span class="o">=</span><span class="n">HIDE_PROGRESSBAR</span><span class="p">,</span> <span class="n">FORCE_READ</span><span class="o">=</span><span class="n">FORCE_READ</span><span class="p">)</span></div>


<div class="viewcode-block" id="ListOfDicomStudies.setFromZip">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.ListOfDicomStudies.setFromZip">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">setFromZip</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">zipFileName</span><span class="p">,</span> <span class="n">HIDE_PROGRESSBAR</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">FORCE_READ</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">FIRST_ONLY</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">matchTagPair</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">dicomDict</span> <span class="o">=</span> <span class="n">dcmTools</span><span class="o">.</span><span class="n">getDicomDictFromZip</span><span class="p">(</span><span class="n">zipFileName</span><span class="p">,</span> <span class="n">FORCE_READ</span><span class="o">=</span><span class="n">FORCE_READ</span><span class="p">,</span> <span class="n">FIRST_ONLY</span><span class="o">=</span><span class="n">FIRST_ONLY</span><span class="p">,</span> <span class="n">OVERVIEW_ONLY</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                    <span class="n">matchingTagValuePair</span><span class="o">=</span><span class="n">matchTagPair</span><span class="p">,</span> <span class="n">QUIET</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ListOfDicomStudies</span><span class="o">.</span><span class="n">setFromDcmDict</span><span class="p">(</span><span class="n">dicomDict</span><span class="p">,</span> <span class="n">HIDE_PROGRESSBAR</span><span class="o">=</span><span class="n">HIDE_PROGRESSBAR</span><span class="p">,</span> <span class="n">FORCE_READ</span><span class="o">=</span><span class="n">FORCE_READ</span><span class="p">)</span></div>



    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1"> studies, </span><span class="si">%d</span><span class="s1"> dicoms&#39;</span><span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNumberOfDicoms</span><span class="p">())</span>

<div class="viewcode-block" id="ListOfDicomStudies.setSafeNameMode">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.ListOfDicomStudies.setSafeNameMode">[docs]</a>
    <span class="k">def</span> <span class="nf">setSafeNameMode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">iStudy</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">iSeries</span> <span class="ow">in</span> <span class="n">iStudy</span><span class="p">:</span>
                <span class="n">iSeries</span><span class="o">.</span><span class="n">SAFE_NAME_MODE</span> <span class="o">=</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="ListOfDicomStudies.isCompressed">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.ListOfDicomStudies.isCompressed">[docs]</a>
    <span class="k">def</span> <span class="nf">isCompressed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isCompressed</span><span class="p">()</span></div>


<div class="viewcode-block" id="ListOfDicomStudies.getNumberOfDicoms">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.ListOfDicomStudies.getNumberOfDicoms">[docs]</a>
    <span class="k">def</span> <span class="nf">getNumberOfDicoms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="n">i</span><span class="o">.</span><span class="n">getNumberOfDicoms</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">])</span></div>


<div class="viewcode-block" id="ListOfDicomStudies.writeToOrganisedFileStructure">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.ListOfDicomStudies.writeToOrganisedFileStructure">[docs]</a>
    <span class="k">def</span> <span class="nf">writeToOrganisedFileStructure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outputRootDir</span><span class="p">,</span> <span class="n">anonName</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">anonID</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">SE_RENAME</span><span class="o">=</span><span class="p">{},</span> <span class="n">REMOVE_PRIVATE_TAGS</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">outDirs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">iStudy</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">suffix</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">for</span> <span class="n">iTag</span> <span class="ow">in</span> <span class="n">SpydcmTK_config</span><span class="o">.</span><span class="n">SUBJECT_NAMING_TAG_LIST</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">anonName</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="ow">in</span> <span class="n">iTag</span><span class="o">.</span><span class="n">lower</span><span class="p">()):</span>
                    <span class="k">continue</span>
                <span class="n">iVal</span> <span class="o">=</span> <span class="n">iStudy</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="n">iTag</span><span class="p">,</span> <span class="n">ifNotFound</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">convertToType</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">iVal</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">suffix</span> <span class="o">+=</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">iVal</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">suffix</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ioutputRootDir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outputRootDir</span><span class="p">,</span> <span class="n">dcmTools</span><span class="o">.</span><span class="n">cleanString</span><span class="p">(</span><span class="n">suffix</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ioutputRootDir</span> <span class="o">=</span> <span class="n">outputRootDir</span>

            <span class="n">ooD</span> <span class="o">=</span> <span class="n">iStudy</span><span class="o">.</span><span class="n">writeToOrganisedFileStructure</span><span class="p">(</span><span class="n">ioutputRootDir</span><span class="p">,</span> <span class="n">anonName</span><span class="o">=</span><span class="n">anonName</span><span class="p">,</span> <span class="n">anonID</span><span class="o">=</span><span class="n">anonID</span><span class="p">,</span> 
                                                       <span class="n">SE_RENAME</span><span class="o">=</span><span class="n">SE_RENAME</span><span class="p">,</span> <span class="n">REMOVE_PRIVATE_TAGS</span><span class="o">=</span><span class="n">REMOVE_PRIVATE_TAGS</span><span class="p">)</span>
            <span class="n">outDirs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ooD</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">outDirs</span></div>


<div class="viewcode-block" id="ListOfDicomStudies.writeToZipArchive">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.ListOfDicomStudies.writeToZipArchive">[docs]</a>
    <span class="k">def</span> <span class="nf">writeToZipArchive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outputRootDir</span><span class="p">,</span> <span class="n">anonName</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">anonID</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">SE_RENAME</span><span class="o">=</span><span class="p">{},</span> <span class="n">CLEAN_UP</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">outDirs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">iStudy</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">ooD</span> <span class="o">=</span> <span class="n">iStudy</span><span class="o">.</span><span class="n">writeToZipArchive</span><span class="p">(</span><span class="n">outputRootDir</span><span class="p">,</span> <span class="n">anonName</span><span class="o">=</span><span class="n">anonName</span><span class="p">,</span> <span class="n">anonID</span><span class="o">=</span><span class="n">anonID</span><span class="p">,</span> <span class="n">SE_RENAME</span><span class="o">=</span><span class="n">SE_RENAME</span><span class="p">,</span> <span class="n">CLEAN_UP</span><span class="o">=</span><span class="n">CLEAN_UP</span><span class="p">)</span>
            <span class="n">outDirs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ooD</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">outDirs</span></div>


<div class="viewcode-block" id="ListOfDicomStudies.getSummaryString">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.ListOfDicomStudies.getSummaryString">[docs]</a>
    <span class="k">def</span> <span class="nf">getSummaryString</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">FULL</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">output</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">getStudySummary</span><span class="p">(</span><span class="n">FULL</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output</span><span class="p">)</span></div>


<div class="viewcode-block" id="ListOfDicomStudies.getTableOfTagValues">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.ListOfDicomStudies.getTableOfTagValues">[docs]</a>
    <span class="k">def</span> <span class="nf">getTableOfTagValues</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">DICOM_TAGS</span><span class="p">,</span> <span class="n">RETURN_STR</span><span class="p">):</span>
        <span class="n">output</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">+=</span> <span class="n">i</span><span class="o">.</span><span class="n">getTagValuesList</span><span class="p">(</span><span class="n">DICOM_TAGS</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">RETURN_STR</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">dcmTools</span><span class="o">.</span><span class="n">_tagValuesListToString</span><span class="p">(</span><span class="n">DICOM_TAGS</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">output</span></div>


<div class="viewcode-block" id="ListOfDicomStudies.printSummaryTable">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.ListOfDicomStudies.printSummaryTable">[docs]</a>
    <span class="k">def</span> <span class="nf">printSummaryTable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">overviewList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTableOfTagValues</span><span class="p">(</span><span class="n">SpydcmTK_config</span><span class="o">.</span><span class="n">SUBJECT_OVERVIEW_TAG_LIST</span><span class="o">+</span><span class="n">SpydcmTK_config</span><span class="o">.</span><span class="n">STUDY_OVERVIEW_TAG_LIST</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SpydcmTK_config</span><span class="o">.</span><span class="n">SUBJECT_OVERVIEW_TAG_LIST</span><span class="o">+</span><span class="n">SpydcmTK_config</span><span class="o">.</span><span class="n">STUDY_OVERVIEW_TAG_LIST</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">overviewList</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">i</span><span class="p">))</span></div>



<div class="viewcode-block" id="ListOfDicomStudies.getStudyByDate">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.ListOfDicomStudies.getStudyByDate">[docs]</a>
    <span class="k">def</span> <span class="nf">getStudyByDate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">date_str</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="s1">&#39;StudyDate&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">date_str</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">i</span></div>


<div class="viewcode-block" id="ListOfDicomStudies.buildMSTable">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.ListOfDicomStudies.buildMSTable">[docs]</a>
    <span class="k">def</span> <span class="nf">buildMSTable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">DICOM_TAGS</span><span class="o">=</span><span class="n">SpydcmTK_config</span><span class="o">.</span><span class="n">SERIES_OVERVIEW_TAG_LIST</span><span class="p">):</span>
        <span class="k">pass</span></div>
</div>

        <span class="c1">#TODO - need to pass series name or something to query and then calc mean / stdev etc</span>

<span class="c1">## =====================================================================================================================</span>
<span class="c1">##   BIDS</span>
<span class="c1">## =====================================================================================================================</span>
<div class="viewcode-block" id="BIDSConst">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.BIDSConst">[docs]</a>
<span class="k">class</span> <span class="nc">BIDSConst</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">anat</span> <span class="o">=</span> <span class="s1">&#39;anat&#39;</span>
    <span class="n">func</span> <span class="o">=</span> <span class="s1">&#39;func&#39;</span>
    <span class="n">dwi</span> <span class="o">=</span> <span class="s1">&#39;dwi&#39;</span>
    <span class="n">fmap</span> <span class="o">=</span> <span class="s1">&#39;fmap&#39;</span>
    <span class="n">code</span> <span class="o">=</span> <span class="s1">&#39;code&#39;</span>
    <span class="n">configf</span> <span class="o">=</span> <span class="s1">&#39;dcm2bids_config.json&#39;</span></div>



<div class="viewcode-block" id="getJsonDict">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.getJsonDict">[docs]</a>
<span class="k">def</span> <span class="nf">getJsonDict</span><span class="p">(</span><span class="n">niiORjsonFile</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">niiORjsonFile</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.nii.gz&#39;</span><span class="p">):</span>
        <span class="n">niiORjsonFile</span> <span class="o">=</span> <span class="n">niiORjsonFile</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.nii.gz&#39;</span><span class="p">,</span><span class="s1">&#39;.json&#39;</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">niiORjsonFile</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">jsonDict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">jsonDict</span></div>


<div class="viewcode-block" id="getTagFromJson">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.getTagFromJson">[docs]</a>
<span class="k">def</span> <span class="nf">getTagFromJson</span><span class="p">(</span><span class="n">niiORjsonFile</span><span class="p">,</span> <span class="n">tag</span><span class="p">):</span>
    <span class="n">jsonDict</span> <span class="o">=</span> <span class="n">getJsonDict</span><span class="p">(</span><span class="n">niiORjsonFile</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">jsonDict</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span></div>



<div class="viewcode-block" id="BIDS_Subject">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.BIDS_Subject">[docs]</a>
<span class="k">class</span> <span class="nc">BIDS_Subject</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class to work with a single BIDS subject</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subjID</span><span class="p">,</span> <span class="n">BIDSDirObj</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">subjID</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;sub-&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subjID</span> <span class="o">=</span> <span class="n">subjID</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subjID</span> <span class="o">=</span> <span class="s1">&#39;sub-</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">subjID</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">BIDSDirObj</span>

    <span class="k">def</span> <span class="fm">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">subjID</span> <span class="o">&gt;</span> <span class="n">other</span><span class="o">.</span><span class="n">subjID</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">subjID</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">subjID</span>

<div class="viewcode-block" id="BIDS_Subject.getSubjID">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.BIDS_Subject.getSubjID">[docs]</a>
    <span class="k">def</span> <span class="nf">getSubjID</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">subjID</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;sub-&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="BIDS_Subject.getSessionDir">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.BIDS_Subject.getSessionDir">[docs]</a>
    <span class="k">def</span> <span class="nf">getSessionDir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">session</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">session</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;ses-&#39;</span><span class="p">):</span>
            <span class="n">session</span> <span class="o">=</span> <span class="s1">&#39;ses-</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">session</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">rootDir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">subjID</span><span class="p">,</span> <span class="n">session</span><span class="p">)</span></div>


<div class="viewcode-block" id="BIDS_Subject.getTypeDir">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.BIDS_Subject.getTypeDir">[docs]</a>
    <span class="k">def</span> <span class="nf">getTypeDir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">TYPE</span><span class="p">,</span> <span class="n">session</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getSessionDir</span><span class="p">(</span><span class="n">session</span><span class="p">),</span> <span class="n">TYPE</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">_getAllTypeNII</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">TYPE</span><span class="p">,</span> <span class="n">session</span><span class="p">):</span>
        <span class="n">dd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTypeDir</span><span class="p">(</span><span class="n">TYPE</span><span class="p">,</span> <span class="n">session</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dd</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">dd</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;nii.gz&#39;</span><span class="p">)]</span>

<div class="viewcode-block" id="BIDS_Subject.getNIIMatchingModality">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.BIDS_Subject.getNIIMatchingModality">[docs]</a>
    <span class="k">def</span> <span class="nf">getNIIMatchingModality</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modality</span><span class="p">,</span> <span class="n">TYPE</span><span class="p">,</span> <span class="n">session</span><span class="p">):</span>
        <span class="n">matchingF</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getAllTypeNII</span><span class="p">(</span><span class="n">TYPE</span><span class="p">,</span> <span class="n">session</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;_</span><span class="si">%s</span><span class="s1">.nii.gz&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">modality</span><span class="p">))]</span>
        <span class="k">return</span> <span class="n">matchingF</span></div>


<div class="viewcode-block" id="BIDS_Subject.getNIIMatchingModality_condition">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.BIDS_Subject.getNIIMatchingModality_condition">[docs]</a>
    <span class="k">def</span> <span class="nf">getNIIMatchingModality_condition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modality</span><span class="p">,</span> <span class="n">TYPE</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="n">matchingNII</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNIIMatchingModality</span><span class="p">(</span><span class="n">modality</span><span class="p">,</span> <span class="n">TYPE</span><span class="p">,</span> <span class="n">session</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matchingNII</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">matchingNII</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">matchingNII</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1"># more than 1 run so need to make decision</span>
            <span class="n">tagList</span> <span class="o">=</span> <span class="p">[</span><span class="n">getTagFromJson</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">matchingNII</span><span class="p">]</span>
            <span class="n">ID</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">tagList</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">matchingNII</span><span class="p">[</span><span class="n">ID</span><span class="p">]</span></div>
</div>



<div class="viewcode-block" id="BIDS_Directory">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.BIDS_Directory">[docs]</a>
<span class="k">class</span> <span class="nc">BIDS_Directory</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class to work with BIDS directory</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rootDirectroy</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rootDir</span> <span class="o">=</span> <span class="n">rootDirectroy</span>

<div class="viewcode-block" id="BIDS_Directory.getConfigFile">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.BIDS_Directory.getConfigFile">[docs]</a>
    <span class="k">def</span> <span class="nf">getConfigFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configFName</span><span class="o">=</span><span class="n">BIDSConst</span><span class="o">.</span><span class="n">configf</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rootDir</span><span class="p">,</span> <span class="n">BIDSConst</span><span class="o">.</span><span class="n">code</span><span class="p">,</span> <span class="n">configFName</span><span class="p">)</span></div>


<div class="viewcode-block" id="BIDS_Directory.getSubjList">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.BIDS_Directory.getSubjList">[docs]</a>
    <span class="k">def</span> <span class="nf">getSubjList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">subjIDs</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rootDir</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;sub-&#39;</span><span class="p">)]</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">BIDS_Subject</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">subjIDs</span><span class="p">])</span></div>
</div>


<div class="viewcode-block" id="walkdir">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.walkdir">[docs]</a>
<span class="k">def</span> <span class="nf">walkdir</span><span class="p">(</span><span class="n">folder</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Walk through each files in a directory&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">dirpath</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">folder</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">filename</span><span class="p">))</span></div>



<div class="viewcode-block" id="organiseDicoms">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.organiseDicoms">[docs]</a>
<span class="k">def</span> <span class="nf">organiseDicoms</span><span class="p">(</span><span class="n">dcmDirectory</span><span class="p">,</span> <span class="n">outputDirectory</span><span class="p">,</span> <span class="n">anonName</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">anonID</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">FORCE_READ</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                   <span class="n">HIDE_PROGRESSBAR</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">REMOVE_PRIVATE_TAGS</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Recurse down directory tree - grab dicoms and move to new</span>
<span class="sd">        hierarchical folder structure</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">HIDE_PROGRESSBAR</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;READING...&#39;</span><span class="p">)</span>
    <span class="n">studies</span> <span class="o">=</span> <span class="n">ListOfDicomStudies</span><span class="o">.</span><span class="n">setFromInput</span><span class="p">(</span><span class="n">dcmDirectory</span><span class="p">,</span> <span class="n">FORCE_READ</span><span class="o">=</span><span class="n">FORCE_READ</span><span class="p">,</span> <span class="n">OVERVIEW</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">HIDE_PROGRESSBAR</span><span class="o">=</span><span class="n">HIDE_PROGRESSBAR</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">HIDE_PROGRESSBAR</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WRITTING...&#39;</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">studies</span><span class="o">.</span><span class="n">writeToOrganisedFileStructure</span><span class="p">(</span><span class="n">outputDirectory</span><span class="p">,</span> <span class="n">anonName</span><span class="o">=</span><span class="n">anonName</span><span class="p">,</span> <span class="n">anonID</span><span class="o">=</span><span class="n">anonID</span><span class="p">,</span> <span class="n">REMOVE_PRIVATE_TAGS</span><span class="o">=</span><span class="n">REMOVE_PRIVATE_TAGS</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">res</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;    ## WARNING - No valid dicoms found&#39;</span><span class="p">)</span></div>



<div class="viewcode-block" id="studySummary">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.studySummary">[docs]</a>
<span class="k">def</span> <span class="nf">studySummary</span><span class="p">(</span><span class="n">pathToDicoms</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param pathToDicoms: path to dicoms - anywhere in the tree above - will search down tree till find a dicom</span>
<span class="sd">    :return: a formatted string</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dStudies</span> <span class="o">=</span> <span class="n">ListOfDicomStudies</span><span class="o">.</span><span class="n">setFromDirectory</span><span class="p">(</span><span class="n">pathToDicoms</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dStudies</span><span class="o">.</span><span class="n">getSummaryString</span><span class="p">()</span></div>




<span class="c1">## =====================================================================================================================</span>
<span class="c1">##   WRITE DICOMS</span>
<span class="c1">## =====================================================================================================================</span>
<div class="viewcode-block" id="writeVTIToDicoms">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.writeVTIToDicoms">[docs]</a>
<span class="k">def</span> <span class="nf">writeVTIToDicoms</span><span class="p">(</span><span class="n">vtiFile</span><span class="p">,</span> <span class="n">dcmTemplateFile_or_ds</span><span class="p">,</span> <span class="n">outputDir</span><span class="p">,</span> <span class="n">arrayName</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tagUpdateDict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">patientMatrixDict</span><span class="o">=</span><span class="p">{}):</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">vtiFile</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">vti</span> <span class="o">=</span> <span class="n">dcmVTKTK</span><span class="o">.</span><span class="n">readVTKFile</span><span class="p">(</span><span class="n">vtiFile</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">arrayName</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">dcmVTKTK</span><span class="o">.</span><span class="n">getScalarsAsNumpy</span><span class="p">(</span><span class="n">vti</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">dcmVTKTK</span><span class="o">.</span><span class="n">getArrayAsNumpy</span><span class="p">(</span><span class="n">vti</span><span class="p">,</span> <span class="n">arrayName</span><span class="p">)</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">vti</span><span class="o">.</span><span class="n">GetDimensions</span><span class="p">(),</span> <span class="s1">&#39;F&#39;</span><span class="p">)</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">A</span><span class="p">),</span> <span class="n">A</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="n">patientMatrixDict</span> <span class="o">=</span> <span class="n">dcmVTKTK</span><span class="o">.</span><span class="n">getPatientMatrixDict</span><span class="p">(</span><span class="n">vti</span><span class="p">,</span> <span class="n">patientMatrixDict</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">writeNumpyArrayToDicom</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">dcmTemplateFile_or_ds</span><span class="p">,</span> <span class="n">patientMatrixDict</span><span class="p">,</span> <span class="n">outputDir</span><span class="p">,</span> <span class="n">tagUpdateDict</span><span class="o">=</span><span class="n">tagUpdateDict</span><span class="p">)</span></div>



<div class="viewcode-block" id="writeNumpyArrayToDicom">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.writeNumpyArrayToDicom">[docs]</a>
<span class="k">def</span> <span class="nf">writeNumpyArrayToDicom</span><span class="p">(</span><span class="n">pixelArray</span><span class="p">,</span> <span class="n">dcmTemplate_or_ds</span><span class="p">,</span> <span class="n">patientMatrixDict</span><span class="p">,</span> <span class="n">outputDir</span><span class="p">,</span> <span class="n">tagUpdateDict</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    patientMatrixDict = {PixelSpacing: [1,2], ImagePositionPatient: [1,3], ImageOrientationPatient: [1,6], SliceThickness: 1}</span>
<span class="sd">    Note - use &quot;SliceThickness&quot; in patientMatrixDict - with assumption that SliceThickness==SpacingBetweenSlices (explicitely built this way - ndArray can not have otherwise)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">tagUpdateDict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">tagUpdateDict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">dcmTemplate_or_ds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dsRAW</span> <span class="o">=</span> <span class="n">dcmTools</span><span class="o">.</span><span class="n">buildFakeDS</span><span class="p">()</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">dcmTemplate_or_ds</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">dsRAW</span> <span class="o">=</span> <span class="n">dicom</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">dcmTemplate_or_ds</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dsRAW</span> <span class="o">=</span> <span class="n">dcmTemplate_or_ds</span>
    <span class="n">nRow</span><span class="p">,</span> <span class="n">nCol</span><span class="p">,</span> <span class="n">nSlice</span> <span class="o">=</span> <span class="n">pixelArray</span><span class="o">.</span><span class="n">shape</span>
    <span class="k">if</span> <span class="n">pixelArray</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">:</span>
        <span class="n">pixelArray</span> <span class="o">=</span> <span class="n">pixelArray</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">13</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">pixelArray</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">pixelArray</span> <span class="o">=</span> <span class="n">pixelArray</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">)</span>
    <span class="n">mx</span><span class="p">,</span> <span class="n">mn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">pixelArray</span><span class="p">),</span> <span class="mi">0</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">slice0</span> <span class="o">=</span> <span class="n">tagUpdateDict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;SliceLocation0&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">slice0</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="n">SeriesUID</span> <span class="o">=</span> <span class="n">dicom</span><span class="o">.</span><span class="n">uid</span><span class="o">.</span><span class="n">generate_uid</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">SeriesNumber</span> <span class="o">=</span> <span class="n">tagUpdateDict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;SeriesNumber&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">SeriesNumber</span> <span class="o">=</span> <span class="n">dsRAW</span><span class="o">.</span><span class="n">SeriesNumber</span> <span class="o">*</span> <span class="mi">100</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">SeriesNumber</span> <span class="o">=</span> <span class="mi">99</span>
    <span class="n">dsList</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nSlice</span><span class="p">):</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">dsRAW</span><span class="p">)</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">SeriesInstanceUID</span> <span class="o">=</span> <span class="n">SeriesUID</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">SOPInstanceUID</span> <span class="o">=</span> <span class="n">dicom</span><span class="o">.</span><span class="n">uid</span><span class="o">.</span><span class="n">generate_uid</span><span class="p">()</span>
        <span class="c1"># ds.SpecificCharacterSet = &#39;ISO_IR 100&#39;</span>
        <span class="c1"># ds.SOPClassUID = &#39;SecondaryCaptureImageStorage&#39;</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">Rows</span> <span class="o">=</span> <span class="n">nRow</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">Columns</span> <span class="o">=</span> <span class="n">nCol</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">ImagesInAcquisition</span> <span class="o">=</span> <span class="n">nSlice</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">InStackPositionNumber</span> <span class="o">=</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span>
        <span class="c1"># ds.RawDataRunNumber = k+1</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">SeriesNumber</span> <span class="o">=</span> <span class="n">SeriesNumber</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">InstanceNumber</span> <span class="o">=</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">SamplesPerPixel</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">BitsAllocated</span> <span class="o">=</span> <span class="mi">16</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">BitsStored</span> <span class="o">=</span> <span class="mi">16</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">HighBit</span> <span class="o">=</span> <span class="mi">15</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">SliceThickness</span> <span class="o">=</span> <span class="n">patientMatrixDict</span><span class="p">[</span><span class="s1">&#39;SpacingBetweenSlices&#39;</span><span class="p">]</span> <span class="c1"># Can no longer claim overlapping slices if have modified</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">SpacingBetweenSlices</span> <span class="o">=</span> <span class="n">patientMatrixDict</span><span class="p">[</span><span class="s1">&#39;SpacingBetweenSlices&#39;</span><span class="p">]</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">SmallestImagePixelValue</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">mn</span><span class="p">)</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">LargestImagePixelValue</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">mx</span><span class="p">)</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">WindowCenter</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">mx</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">WindowWidth</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">mx</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">PixelSpacing</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">patientMatrixDict</span><span class="p">[</span><span class="s1">&#39;PixelSpacing&#39;</span><span class="p">])</span>
        <span class="n">kVec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">patientMatrixDict</span><span class="p">[</span><span class="s1">&#39;ImageOrientationPatient&#39;</span><span class="p">][:</span><span class="mi">3</span><span class="p">],</span>
                        <span class="n">patientMatrixDict</span><span class="p">[</span><span class="s1">&#39;ImageOrientationPatient&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">:])</span>
        <span class="n">ImagePositionPatient</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">patientMatrixDict</span><span class="p">[</span><span class="s1">&#39;ImagePositionPatient&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="n">k</span><span class="o">*</span><span class="n">kVec</span><span class="o">*</span><span class="n">ds</span><span class="o">.</span><span class="n">SpacingBetweenSlices</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">ImagePositionPatient</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ImagePositionPatient</span><span class="p">)</span>
        <span class="c1"># try:</span>
        <span class="n">sliceLoc</span> <span class="o">=</span> <span class="n">slice0</span> <span class="o">+</span> <span class="n">k</span><span class="o">*</span><span class="n">ds</span><span class="o">.</span><span class="n">SpacingBetweenSlices</span>
        <span class="c1"># except KeyError:</span>
        <span class="c1">#     sliceLoc = dcmTools.distPts(ImagePositionPatient, np.array(patientMatrixDict[&#39;ImagePositionPatient&#39;]))</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">SliceLocation</span> <span class="o">=</span> <span class="n">sliceLoc</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">ImageOrientationPatient</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">patientMatrixDict</span><span class="p">[</span><span class="s1">&#39;ImageOrientationPatient&#39;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">iKey</span> <span class="ow">in</span> <span class="n">tagUpdateDict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">ds</span><span class="p">[</span><span class="n">iKey</span><span class="p">]</span> <span class="o">=</span> <span class="n">tagUpdateDict</span><span class="p">[</span><span class="n">iKey</span><span class="p">]</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
                <span class="n">ds</span><span class="o">.</span><span class="n">add_new</span><span class="p">(</span><span class="n">tagUpdateDict</span><span class="p">[</span><span class="n">iKey</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">tagUpdateDict</span><span class="p">[</span><span class="n">iKey</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">tagUpdateDict</span><span class="p">[</span><span class="n">iKey</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
        <span class="c1"># ds.PixelData = pixelArray[:,:,k].tostring()</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">PixelData</span> <span class="o">=</span> <span class="n">pixelArray</span><span class="p">[:,:,</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
        <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;PixelData&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">VR</span> <span class="o">=</span> <span class="s1">&#39;OW&#39;</span>
        <span class="n">dsList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
    <span class="n">dcmSeries</span> <span class="o">=</span> <span class="n">DicomSeries</span><span class="p">(</span><span class="n">dsList</span><span class="p">,</span> <span class="n">HIDE_PROGRESSBAR</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">dcmSeries</span><span class="o">.</span><span class="n">writeToOrganisedFileStructure</span><span class="p">(</span><span class="n">outputDir</span><span class="p">)</span></div>




<div class="viewcode-block" id="getResolution">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.getResolution">[docs]</a>
<span class="k">def</span> <span class="nf">getResolution</span><span class="p">(</span><span class="n">dataVts</span><span class="p">):</span>
    <span class="n">o</span><span class="p">,</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">,</span><span class="n">p3</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">]</span>
    <span class="n">i0</span><span class="p">,</span><span class="n">i1</span><span class="p">,</span><span class="n">j0</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">k0</span><span class="p">,</span><span class="n">k1</span> <span class="o">=</span> <span class="n">dataVts</span><span class="o">.</span><span class="n">GetExtent</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">i0</span><span class="p">,</span><span class="n">i1</span><span class="p">,</span><span class="n">j0</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">k0</span><span class="p">,</span><span class="n">k1</span><span class="p">)</span>
    <span class="n">dataVts</span><span class="o">.</span><span class="n">GetPoint</span><span class="p">(</span><span class="n">i0</span><span class="p">,</span><span class="n">j0</span><span class="p">,</span><span class="n">k0</span><span class="p">,</span> <span class="n">o</span><span class="p">)</span>
    <span class="n">dataVts</span><span class="o">.</span><span class="n">GetPoint</span><span class="p">(</span><span class="n">i0</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j0</span><span class="p">,</span><span class="n">k0</span><span class="p">,</span> <span class="n">p1</span><span class="p">)</span>
    <span class="n">dataVts</span><span class="o">.</span><span class="n">GetPoint</span><span class="p">(</span><span class="n">i0</span><span class="p">,</span><span class="n">j0</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k0</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span>
    <span class="n">dataVts</span><span class="o">.</span><span class="n">GetPoint</span><span class="p">(</span><span class="n">i0</span><span class="p">,</span><span class="n">j0</span><span class="p">,</span><span class="n">k0</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">p3</span><span class="p">)</span>
    <span class="n">di</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">distBetweenTwoPts</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">o</span><span class="p">))</span>
    <span class="n">dj</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">distBetweenTwoPts</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="n">o</span><span class="p">))</span>
    <span class="n">dk</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">distBetweenTwoPts</span><span class="p">(</span><span class="n">p3</span><span class="p">,</span> <span class="n">o</span><span class="p">))</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">di</span><span class="p">,</span> <span class="n">dj</span><span class="p">,</span> <span class="n">dk</span><span class="p">]</span></div>


<div class="viewcode-block" id="distBetweenTwoPts">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.distBetweenTwoPts">[docs]</a>
<span class="k">def</span> <span class="nf">distBetweenTwoPts</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">b</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span></div>


<div class="viewcode-block" id="printPoints">
<a class="viewcode-back" href="../../spydcmtk.html#spydcmtk.dcmTK.printPoints">[docs]</a>
<span class="k">def</span> <span class="nf">printPoints</span><span class="p">(</span><span class="n">vtsD</span><span class="p">):</span>
    <span class="n">dd</span> <span class="o">=</span> <span class="n">vtsD</span><span class="o">.</span><span class="n">GetDimensions</span><span class="p">()</span>
    <span class="n">ijks</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">]]</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">ijks</span><span class="p">:</span>
        <span class="n">ID</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel_multi_index</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span> <span class="n">dd</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span> <span class="n">ID</span><span class="p">,</span> <span class="n">vtsD</span><span class="o">.</span><span class="n">GetPoint</span><span class="p">(</span><span class="n">ID</span><span class="p">))</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Fraser M. Callaghan.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>